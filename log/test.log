  [1m[36mActiveRecord::InternalMetadata Pluck (0.4ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (1.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.3ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.2ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.2ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.3ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.3ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.2ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.2ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (25.0ms)[0m  [1m[35mDROP DATABASE IF EXISTS "url_shortener_test"[0m
  [1m[35m (73.9ms)[0m  [1m[35mCREATE DATABASE "url_shortener_test" ENCODING = 'utf8'[0m
  [1m[35mSQL (0.3ms)[0m  [1m[35mCREATE EXTENSION IF NOT EXISTS "plpgsql"[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "urls" CASCADE[0m
  [1m[35m (5.2ms)[0m  [1m[35mCREATE TABLE "urls" ("id" bigserial primary key, "original_url" character varying, "short_code" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (2.4ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.5ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20230611133639)[0m
  [1m[35m (2.7ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.7ms)[0m  [1m[34mSELECT "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::InternalMetadata Create (0.4ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "key"[0m  [["key", "environment"], ["value", "test"], ["created_at", "2023-06-11 16:16:32.708464"], ["updated_at", "2023-06-11 16:16:32.708464"]]
  [1m[36mTRANSACTION (3.7ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::InternalMetadata Create (0.2ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "key"[0m  [["key", "schema_sha1"], ["value", "99ba3125f3f226c8c6d7425d5f80234687e9cc1b"], ["created_at", "2023-06-11 16:16:32.718146"], ["updated_at", "2023-06-11 16:16:32.718146"]]
  [1m[36mTRANSACTION (2.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.3ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------
UrlsControllerTest: test_should_return_a_list_of_URLs
-----------------------------------------------------
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.5ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", nil], ["created_at", "2023-06-11 16:17:47.560686"], ["updated_at", "2023-06-11 16:17:47.560686"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
Started GET "/urls" for 127.0.0.1 at 2023-06-11 21:47:47 +0530
Processing by UrlsController#index as HTML
Filter chain halted as :authenticate rendered or redirected
Completed 401 Unauthorized in 5ms (ActiveRecord: 0.0ms | Allocations: 2886)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------
UrlsControllerTest: test_should_redirect_to_the_original_URL
------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "703e4b"], ["created_at", "2023-06-11 16:17:47.647338"], ["updated_at", "2023-06-11 16:17:47.647338"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
UrlsControllerTest: test_should_handle_invalid_URL_creation
-----------------------------------------------------------
Started POST "/urls" for 127.0.0.1 at 2023-06-11 21:47:47 +0530
Processing by UrlsController#create as HTML
  Parameters: {"url"=>{"original_url"=>""}}
Filter chain halted as :authenticate rendered or redirected
Completed 401 Unauthorized in 0ms (ActiveRecord: 0.0ms | Allocations: 97)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------
UrlsControllerTest: test_should_handle_URL_not_found
----------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------
UrlsControllerTest: test_should_create_a_new_URL
------------------------------------------------
Started POST "/urls" for 127.0.0.1 at 2023-06-11 21:47:47 +0530
Processing by UrlsController#create as HTML
  Parameters: {"url"=>{"original_url"=>"https://example.com"}}
Filter chain halted as :authenticate rendered or redirected
Completed 401 Unauthorized in 0ms (ActiveRecord: 0.0ms | Allocations: 78)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.3ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------
UrlsControllerTest: test_should_redirect_to_the_original_URL
------------------------------------------------------------
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.4ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", nil], ["created_at", "2023-06-11 16:19:02.175556"], ["updated_at", "2023-06-11 16:19:02.175556"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
UrlsControllerTest: test_should_handle_invalid_URL_creation
-----------------------------------------------------------
Started POST "/urls" for 127.0.0.1 at 2023-06-11 21:49:02 +0530
Processing by UrlsController#create as HTML
  Parameters: {"url"=>{"original_url"=>""}}
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.3ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", ""], ["short_code", "0ecab7"], ["created_at", "2023-06-11 16:19:02.269111"], ["updated_at", "2023-06-11 16:19:02.269111"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 8ms (Views: 0.3ms | ActiveRecord: 0.8ms | Allocations: 4061)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------
UrlsControllerTest: test_should_handle_URL_not_found
----------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------
UrlsControllerTest: test_should_return_a_list_of_URLs
-----------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.3ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "d3d510"], ["created_at", "2023-06-11 16:19:02.282448"], ["updated_at", "2023-06-11 16:19:02.282448"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.org"], ["short_code", "fc53d7"], ["created_at", "2023-06-11 16:19:02.284720"], ["updated_at", "2023-06-11 16:19:02.284720"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/urls" for 127.0.0.1 at 2023-06-11 21:49:02 +0530
Processing by UrlsController#index as HTML
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls"[0m
Completed 200 OK in 2ms (Views: 0.9ms | ActiveRecord: 0.2ms | Allocations: 766)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------
UrlsControllerTest: test_should_create_a_new_URL
------------------------------------------------
Started POST "/urls" for 127.0.0.1 at 2023-06-11 21:49:02 +0530
Processing by UrlsController#create as HTML
  Parameters: {"url"=>{"original_url"=>"https://example.com"}}
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.3ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "57bb48"], ["created_at", "2023-06-11 16:19:02.294583"], ["updated_at", "2023-06-11 16:19:02.294583"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 3ms (Views: 0.1ms | ActiveRecord: 0.7ms | Allocations: 871)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.3ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------
UrlsControllerTest: test_should_create_a_new_URL
------------------------------------------------
Started POST "/urls" for 127.0.0.1 at 2023-06-11 21:49:49 +0530
Processing by UrlsController#create as HTML
  Parameters: {"url"=>{"original_url"=>"https://example.com"}}
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.5ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "f970d7"], ["created_at", "2023-06-11 16:19:49.178661"], ["updated_at", "2023-06-11 16:19:49.178661"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 36ms (Views: 0.3ms | ActiveRecord: 4.7ms | Allocations: 20778)
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------
UrlsControllerTest: test_should_redirect_to_the_original_URL
------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "504faa"], ["created_at", "2023-06-11 16:19:49.186894"], ["updated_at", "2023-06-11 16:19:49.186894"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/504faa" for 127.0.0.1 at 2023-06-11 21:49:49 +0530
Processing by UrlsController#redirect as HTML
  Parameters: {"short_code"=>"504faa"}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "504faa"], ["LIMIT", 1]]
Redirected to https://example.com
Completed 302 Found in 2ms (ActiveRecord: 0.3ms | Allocations: 711)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
UrlsControllerTest: test_should_handle_invalid_URL_creation
-----------------------------------------------------------
Started POST "/urls" for 127.0.0.1 at 2023-06-11 21:49:49 +0530
Processing by UrlsController#create as HTML
  Parameters: {"url"=>{"original_url"=>""}}
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", ""], ["short_code", "f38aba"], ["created_at", "2023-06-11 16:19:49.197472"], ["updated_at", "2023-06-11 16:19:49.197472"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 2ms (Views: 0.2ms | ActiveRecord: 0.6ms | Allocations: 880)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------
UrlsControllerTest: test_should_return_a_list_of_URLs
-----------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "9db7c4"], ["created_at", "2023-06-11 16:19:49.201135"], ["updated_at", "2023-06-11 16:19:49.201135"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.org"], ["short_code", "f3e0ad"], ["created_at", "2023-06-11 16:19:49.202807"], ["updated_at", "2023-06-11 16:19:49.202807"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/urls" for 127.0.0.1 at 2023-06-11 21:49:49 +0530
Processing by UrlsController#index as HTML
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls"[0m
Completed 200 OK in 1ms (Views: 0.7ms | ActiveRecord: 0.2ms | Allocations: 530)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------
UrlsControllerTest: test_should_handle_URL_not_found
----------------------------------------------------
Started GET "/invalid_short_code" for 127.0.0.1 at 2023-06-11 21:49:49 +0530
Processing by UrlsController#redirect as HTML
  Parameters: {"short_code"=>"invalid_short_code"}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "invalid_short_code"], ["LIMIT", 1]]
  Rendering text template
  Rendered text template (Duration: 0.0ms | Allocations: 8)
Completed 404 Not Found in 8ms (Views: 7.2ms | ActiveRecord: 0.2ms | Allocations: 2526)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.4ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------
UrlsControllerTest: test_should_handle_URL_not_found
----------------------------------------------------
Started GET "/invalid_short_code" for 127.0.0.1 at 2023-06-11 21:50:04 +0530
Processing by UrlsController#redirect as HTML
  Parameters: {"short_code"=>"invalid_short_code"}
  [1m[36mUrl Load (0.3ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "invalid_short_code"], ["LIMIT", 1]]
  Rendering text template
  Rendered text template (Duration: 0.0ms | Allocations: 8)
Completed 404 Not Found in 9ms (Views: 2.3ms | ActiveRecord: 1.5ms | Allocations: 6056)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------
UrlsControllerTest: test_should_redirect_to_the_original_URL
------------------------------------------------------------
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.4ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "f49528"], ["created_at", "2023-06-11 16:20:04.265671"], ["updated_at", "2023-06-11 16:20:04.265671"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/f49528" for 127.0.0.1 at 2023-06-11 21:50:04 +0530
Processing by UrlsController#redirect as HTML
  Parameters: {"short_code"=>"f49528"}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "f49528"], ["LIMIT", 1]]
Redirected to https://example.com
Completed 302 Found in 1ms (ActiveRecord: 0.2ms | Allocations: 344)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------
UrlsControllerTest: test_should_return_a_list_of_URLs
-----------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "06ab11"], ["created_at", "2023-06-11 16:20:04.272625"], ["updated_at", "2023-06-11 16:20:04.272625"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.org"], ["short_code", "054e90"], ["created_at", "2023-06-11 16:20:04.274390"], ["updated_at", "2023-06-11 16:20:04.274390"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/urls" for 127.0.0.1 at 2023-06-11 21:50:04 +0530
Processing by UrlsController#index as HTML
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls"[0m
Completed 200 OK in 1ms (Views: 0.8ms | ActiveRecord: 0.2ms | Allocations: 599)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------
UrlsControllerTest: test_should_create_a_new_URL
------------------------------------------------
Started POST "/urls" for 127.0.0.1 at 2023-06-11 21:50:04 +0530
Processing by UrlsController#create as HTML
  Parameters: {"url"=>{"original_url"=>"https://example.com"}}
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "04ac81"], ["created_at", "2023-06-11 16:20:04.285120"], ["updated_at", "2023-06-11 16:20:04.285120"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 3ms (Views: 0.2ms | ActiveRecord: 0.7ms | Allocations: 1102)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
UrlsControllerTest: test_should_handle_invalid_URL_creation
-----------------------------------------------------------
Started POST "/urls" for 127.0.0.1 at 2023-06-11 21:50:04 +0530
Processing by UrlsController#create as HTML
  Parameters: {"url"=>{"original_url"=>""}}
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", ""], ["short_code", "56d630"], ["created_at", "2023-06-11 16:20:04.290381"], ["updated_at", "2023-06-11 16:20:04.290381"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 3ms (Views: 0.2ms | ActiveRecord: 0.8ms | Allocations: 756)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (1.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------
UrlsControllerTest: test_should_return_a_list_of_URLs
-----------------------------------------------------
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.5ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", nil], ["created_at", "2023-06-11 16:24:07.328257"], ["updated_at", "2023-06-11 16:24:07.328257"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
Started GET "/urls" for 127.0.0.1 at 2023-06-11 21:54:07 +0530
Processing by UrlsController#index as HTML
  [1m[36mUrl Load (0.3ms)[0m  [1m[34mSELECT "urls".* FROM "urls"[0m
Completed 200 OK in 9ms (Views: 2.0ms | ActiveRecord: 0.3ms | Allocations: 3589)
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------
UrlsControllerTest: test_should_create_a_new_URL
------------------------------------------------
Started POST "/urls" for 127.0.0.1 at 2023-06-11 21:54:07 +0530
Processing by UrlsController#create as HTML
  Parameters: {"url"=>{"original_url"=>"https://example.com"}}
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.3ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "1f5b67"], ["created_at", "2023-06-11 16:24:07.418867"], ["updated_at", "2023-06-11 16:24:07.418867"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 3ms (Views: 0.2ms | ActiveRecord: 0.9ms | Allocations: 1143)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------
UrlsControllerTest: test_should_handle_URL_not_found
----------------------------------------------------
Started GET "/invalid_short_code" for 127.0.0.1 at 2023-06-11 21:54:07 +0530
Processing by UrlsController#redirect as HTML
  Parameters: {"short_code"=>"invalid_short_code"}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "invalid_short_code"], ["LIMIT", 1]]
  Rendering text template
  Rendered text template (Duration: 0.0ms | Allocations: 8)
Completed 404 Not Found in 7ms (Views: 5.0ms | ActiveRecord: 0.3ms | Allocations: 2183)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------
UrlsControllerTest: test_should_redirect_to_the_original_URL
------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "cef8ff"], ["created_at", "2023-06-11 16:24:07.432042"], ["updated_at", "2023-06-11 16:24:07.432042"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/cef8ff" for 127.0.0.1 at 2023-06-11 21:54:07 +0530
Processing by UrlsController#redirect as HTML
  Parameters: {"short_code"=>"cef8ff"}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "cef8ff"], ["LIMIT", 1]]
Redirected to https://example.com
Completed 302 Found in 1ms (ActiveRecord: 0.2ms | Allocations: 309)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------
UrlTest: test_should_have_a_unique_short_code
---------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.3ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "b19c1f"], ["created_at", "2023-06-11 16:24:07.437640"], ["updated_at", "2023-06-11 16:24:07.437640"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "b19c1f"], ["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "b19c1f"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------
UrlTest: test_should_not_save_an_invalid_URL
--------------------------------------------
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------
UrlTest: test_should_save_a_valid_URL
-------------------------------------
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "852cf4"], ["created_at", "2023-06-11 16:24:07.443248"], ["updated_at", "2023-06-11 16:24:07.443248"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.4ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------
UrlsControllerTest: test_should_create_a_new_URL
------------------------------------------------
Started POST "/urls" for 127.0.0.1 at 2023-06-11 21:55:30 +0530
Processing by UrlsController#create as HTML
  Parameters: {"url"=>{"original_url"=>"https://example.com"}}
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.4ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "648b3e"], ["created_at", "2023-06-11 16:25:30.879953"], ["updated_at", "2023-06-11 16:25:30.879953"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 37ms (Views: 0.3ms | ActiveRecord: 4.7ms | Allocations: 20779)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------
UrlsControllerTest: test_should_redirect_to_the_original_URL
------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "26fab6"], ["created_at", "2023-06-11 16:25:30.886772"], ["updated_at", "2023-06-11 16:25:30.886772"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/26fab6" for 127.0.0.1 at 2023-06-11 21:55:30 +0530
Processing by UrlsController#redirect as HTML
  Parameters: {"short_code"=>"26fab6"}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "26fab6"], ["LIMIT", 1]]
Redirected to https://example.com
Completed 302 Found in 2ms (ActiveRecord: 0.3ms | Allocations: 711)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------
UrlsControllerTest: test_should_handle_URL_not_found
----------------------------------------------------
Started GET "/invalid_short_code" for 127.0.0.1 at 2023-06-11 21:55:30 +0530
Processing by UrlsController#redirect as HTML
  Parameters: {"short_code"=>"invalid_short_code"}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "invalid_short_code"], ["LIMIT", 1]]
  Rendering text template
  Rendered text template (Duration: 0.0ms | Allocations: 8)
Completed 404 Not Found in 6ms (Views: 5.2ms | ActiveRecord: 0.2ms | Allocations: 1980)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------
UrlsControllerTest: test_should_return_a_list_of_URLs
-----------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.3ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "7c50f9"], ["created_at", "2023-06-11 16:25:30.903811"], ["updated_at", "2023-06-11 16:25:30.903811"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.org"], ["short_code", "2dc354"], ["created_at", "2023-06-11 16:25:30.905782"], ["updated_at", "2023-06-11 16:25:30.905782"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/urls" for 127.0.0.1 at 2023-06-11 21:55:30 +0530
Processing by UrlsController#index as HTML
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls"[0m
Completed 200 OK in 1ms (Views: 0.7ms | ActiveRecord: 0.2ms | Allocations: 578)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------
UrlsControllerTest: test_should_handle_valid_URL_creation
---------------------------------------------------------
Started POST "/urls" for 127.0.0.1 at 2023-06-11 21:55:30 +0530
Processing by UrlsController#create as HTML
  Parameters: {"url"=>{"original_url"=>"http://123.com"}}
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "http://123.com"], ["short_code", "59be79"], ["created_at", "2023-06-11 16:25:30.912338"], ["updated_at", "2023-06-11 16:25:30.912338"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 2ms (Views: 0.1ms | ActiveRecord: 0.7ms | Allocations: 778)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------
UrlTest: test_should_not_save_an_invalid_URL
--------------------------------------------
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------
UrlTest: test_should_have_a_unique_short_code
---------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "db1b2d"], ["created_at", "2023-06-11 16:25:30.918243"], ["updated_at", "2023-06-11 16:25:30.918243"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "db1b2d"], ["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "db1b2d"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------
UrlTest: test_should_save_a_valid_URL
-------------------------------------
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "d81f0f"], ["created_at", "2023-06-11 16:25:30.922059"], ["updated_at", "2023-06-11 16:25:30.922059"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.3ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------
UrlsControllerTest: test_should_redirect_to_the_original_URL
------------------------------------------------------------
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.4ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", nil], ["created_at", "2023-06-11 16:25:37.264471"], ["updated_at", "2023-06-11 16:25:37.264471"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/" for 127.0.0.1 at 2023-06-11 21:55:37 +0530
Processing by UrlsController#create as HTML
Completed 400 Bad Request in 4ms (ActiveRecord: 0.0ms | Allocations: 3104)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------
UrlsControllerTest: test_should_handle_valid_URL_creation
---------------------------------------------------------
Started POST "/urls" for 127.0.0.1 at 2023-06-11 21:55:37 +0530
Processing by UrlsController#create as HTML
  Parameters: {"url"=>{"original_url"=>"http://123.com"}}
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.3ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "http://123.com"], ["short_code", "bfe8ed"], ["created_at", "2023-06-11 16:25:37.340431"], ["updated_at", "2023-06-11 16:25:37.340431"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 3ms (Views: 0.2ms | ActiveRecord: 0.7ms | Allocations: 1246)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------
UrlsControllerTest: test_should_handle_URL_not_found
----------------------------------------------------
Started GET "/invalid_short_code" for 127.0.0.1 at 2023-06-11 21:55:37 +0530
Processing by UrlsController#redirect as HTML
  Parameters: {"short_code"=>"invalid_short_code"}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "invalid_short_code"], ["LIMIT", 1]]
  Rendering text template
  Rendered text template (Duration: 0.0ms | Allocations: 8)
Completed 404 Not Found in 4ms (Views: 2.5ms | ActiveRecord: 0.4ms | Allocations: 2348)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------
UrlsControllerTest: test_should_create_a_new_URL
------------------------------------------------
Started POST "/urls" for 127.0.0.1 at 2023-06-11 21:55:37 +0530
Processing by UrlsController#create as HTML
  Parameters: {"url"=>{"original_url"=>"https://example.com"}}
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "84b0a5"], ["created_at", "2023-06-11 16:25:37.354617"], ["updated_at", "2023-06-11 16:25:37.354617"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 3ms (Views: 0.2ms | ActiveRecord: 0.8ms | Allocations: 976)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------
UrlsControllerTest: test_should_return_a_list_of_URLs
-----------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "d57950"], ["created_at", "2023-06-11 16:25:37.358422"], ["updated_at", "2023-06-11 16:25:37.358422"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.org"], ["short_code", "944f40"], ["created_at", "2023-06-11 16:25:37.360316"], ["updated_at", "2023-06-11 16:25:37.360316"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/urls" for 127.0.0.1 at 2023-06-11 21:55:37 +0530
Processing by UrlsController#index as HTML
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls"[0m
Completed 200 OK in 1ms (Views: 0.8ms | ActiveRecord: 0.2ms | Allocations: 564)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------
UrlTest: test_should_not_save_an_invalid_URL
--------------------------------------------
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------
UrlTest: test_should_save_a_valid_URL
-------------------------------------
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "6d58db"], ["created_at", "2023-06-11 16:25:37.368704"], ["updated_at", "2023-06-11 16:25:37.368704"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------
UrlTest: test_should_have_a_unique_short_code
---------------------------------------------
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.3ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "86d549"], ["created_at", "2023-06-11 16:25:37.371938"], ["updated_at", "2023-06-11 16:25:37.371938"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "86d549"], ["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "86d549"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.3ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------
UrlsControllerTest: test_should_handle_URL_not_found
----------------------------------------------------
Started GET "/invalid_short_code" for 127.0.0.1 at 2023-06-11 21:55:59 +0530
Processing by UrlsController#redirect as HTML
  Parameters: {"short_code"=>"invalid_short_code"}
  [1m[36mUrl Load (0.3ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "invalid_short_code"], ["LIMIT", 1]]
  Rendering text template
  Rendered text template (Duration: 0.0ms | Allocations: 8)
Completed 404 Not Found in 12ms (Views: 4.4ms | ActiveRecord: 1.5ms | Allocations: 6056)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------
UrlsControllerTest: test_should_return_a_list_of_URLs
-----------------------------------------------------
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.4ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "17aa7c"], ["created_at", "2023-06-11 16:25:59.793083"], ["updated_at", "2023-06-11 16:25:59.793083"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.4ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.org"], ["short_code", "28b1c8"], ["created_at", "2023-06-11 16:25:59.795626"], ["updated_at", "2023-06-11 16:25:59.795626"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/urls" for 127.0.0.1 at 2023-06-11 21:55:59 +0530
Processing by UrlsController#index as HTML
  [1m[36mUrl Load (0.3ms)[0m  [1m[34mSELECT "urls".* FROM "urls"[0m
Completed 200 OK in 2ms (Views: 1.0ms | ActiveRecord: 0.3ms | Allocations: 647)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------
UrlsControllerTest: test_should_redirect_to_the_original_URL
------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "1c7873"], ["created_at", "2023-06-11 16:25:59.803280"], ["updated_at", "2023-06-11 16:25:59.803280"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/1c7873" for 127.0.0.1 at 2023-06-11 21:55:59 +0530
Processing by UrlsController#redirect as HTML
  Parameters: {"short_code"=>"1c7873"}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "1c7873"], ["LIMIT", 1]]
Redirected to https://example.com
Completed 302 Found in 1ms (ActiveRecord: 0.2ms | Allocations: 297)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------
UrlsControllerTest: test_should_create_a_new_URL
------------------------------------------------
Started POST "/urls" for 127.0.0.1 at 2023-06-11 21:55:59 +0530
Processing by UrlsController#create as HTML
  Parameters: {"url"=>{"original_url"=>"https://example.com"}}
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "cfe8c6"], ["created_at", "2023-06-11 16:25:59.815607"], ["updated_at", "2023-06-11 16:25:59.815607"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 3ms (Views: 0.2ms | ActiveRecord: 0.7ms | Allocations: 1102)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------
UrlTest: test_should_not_save_an_invalid_URL
--------------------------------------------
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------
UrlTest: test_should_save_a_valid_URL
-------------------------------------
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "a183fe"], ["created_at", "2023-06-11 16:25:59.821993"], ["updated_at", "2023-06-11 16:25:59.821993"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------
UrlTest: test_should_have_a_unique_short_code
---------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "028bd7"], ["created_at", "2023-06-11 16:25:59.825049"], ["updated_at", "2023-06-11 16:25:59.825049"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "028bd7"], ["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "028bd7"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.3ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------
UrlTest: test_should_not_save_an_invalid_URL
--------------------------------------------
  [1m[36mUrl Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------
UrlTest: test_should_have_a_unique_short_code
---------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.3ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", nil], ["created_at", "2023-06-11 16:26:10.705110"], ["updated_at", "2023-06-11 16:26:10.705110"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------
UrlTest: test_should_save_a_valid_URL
-------------------------------------
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", nil], ["created_at", "2023-06-11 16:26:10.708928"], ["updated_at", "2023-06-11 16:26:10.708928"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------
UrlsControllerTest: test_should_create_a_new_URL
------------------------------------------------
Started POST "/urls" for 127.0.0.1 at 2023-06-11 21:56:10 +0530
Processing by UrlsController#create as HTML
  Parameters: {"url"=>{"original_url"=>"https://example.com"}}
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "78ce98"], ["created_at", "2023-06-11 16:26:10.845108"], ["updated_at", "2023-06-11 16:26:10.845108"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 6ms (Views: 0.2ms | ActiveRecord: 0.8ms | Allocations: 4069)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------
UrlsControllerTest: test_should_handle_URL_not_found
----------------------------------------------------
Started GET "/invalid_short_code" for 127.0.0.1 at 2023-06-11 21:56:10 +0530
Processing by UrlsController#redirect as HTML
  Parameters: {"short_code"=>"invalid_short_code"}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "invalid_short_code"], ["LIMIT", 1]]
  Rendering text template
  Rendered text template (Duration: 0.0ms | Allocations: 8)
Completed 404 Not Found in 4ms (Views: 2.3ms | ActiveRecord: 0.4ms | Allocations: 2375)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------
UrlsControllerTest: test_should_return_a_list_of_URLs
-----------------------------------------------------
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "53bec0"], ["created_at", "2023-06-11 16:26:10.858765"], ["updated_at", "2023-06-11 16:26:10.858765"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.org"], ["short_code", "9a0610"], ["created_at", "2023-06-11 16:26:10.860621"], ["updated_at", "2023-06-11 16:26:10.860621"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/urls" for 127.0.0.1 at 2023-06-11 21:56:10 +0530
Processing by UrlsController#index as HTML
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls"[0m
Completed 200 OK in 1ms (Views: 0.7ms | ActiveRecord: 0.2ms | Allocations: 607)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------
UrlsControllerTest: test_should_redirect_to_the_original_URL
------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "45dc0f"], ["created_at", "2023-06-11 16:26:10.865905"], ["updated_at", "2023-06-11 16:26:10.865905"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/45dc0f" for 127.0.0.1 at 2023-06-11 21:56:10 +0530
Processing by UrlsController#redirect as HTML
  Parameters: {"short_code"=>"45dc0f"}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "45dc0f"], ["LIMIT", 1]]
Redirected to https://example.com
Completed 302 Found in 1ms (ActiveRecord: 0.2ms | Allocations: 297)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.4ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-------------------------------------
UrlTest: test_should_save_a_valid_URL
-------------------------------------
  [1m[36mUrl Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Create (0.4ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", nil], ["created_at", "2023-06-11 16:26:35.849019"], ["updated_at", "2023-06-11 16:26:35.849019"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------
UrlTest: test_should_not_save_an_invalid_URL
--------------------------------------------
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------
UrlTest: test_should_have_a_unique_short_code
---------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", nil], ["created_at", "2023-06-11 16:26:35.854180"], ["updated_at", "2023-06-11 16:26:35.854180"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.4ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.3ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.7ms)[0m  [1m[35mALTER TABLE "urls" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.8ms)[0m  [1m[31mDELETE FROM "urls";
INSERT INTO "urls" ("id", "original_url", "short_code", "created_at", "updated_at") VALUES (980190962, 'MyString', 'MyString', '2023-06-11 16:30:25.215984', '2023-06-11 16:30:25.215984'), (298486374, 'MyString', 'MyString', '2023-06-11 16:30:25.215984', '2023-06-11 16:30:25.215984')[0m
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "urls" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (285.2ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------
UrlsControllerTest: test_should_handle_URL_not_found
----------------------------------------------------
Started GET "/invalid_short_code" for 127.0.0.1 at 2023-06-11 22:00:25 +0530
Processing by UrlsController#redirect as HTML
  Parameters: {"short_code"=>"invalid_short_code"}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "invalid_short_code"], ["LIMIT", 1]]
  Rendering text template
  Rendered text template (Duration: 0.0ms | Allocations: 8)
Completed 404 Not Found in 14ms (Views: 6.1ms | ActiveRecord: 0.4ms | Allocations: 5453)
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------
UrlsControllerTest: test_should_redirect_to_the_original_URL
------------------------------------------------------------
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.5ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "6ee480"], ["created_at", "2023-06-11 16:30:25.744156"], ["updated_at", "2023-06-11 16:30:25.744156"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/6ee480" for 127.0.0.1 at 2023-06-11 22:00:25 +0530
Processing by UrlsController#redirect as HTML
  Parameters: {"short_code"=>"6ee480"}
  [1m[36mUrl Load (0.3ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "6ee480"], ["LIMIT", 1]]
Redirected to https://example.com
Completed 302 Found in 1ms (ActiveRecord: 0.3ms | Allocations: 343)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------
UrlsControllerTest: test_should_create_a_new_URL
------------------------------------------------
Started POST "/urls" for 127.0.0.1 at 2023-06-11 22:00:25 +0530
Processing by UrlsController#create as HTML
  Parameters: {"url"=>{"original_url"=>"https://example.com"}}
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.4ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "4555cc"], ["created_at", "2023-06-11 16:30:25.765914"], ["updated_at", "2023-06-11 16:30:25.765914"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 5ms (Views: 0.2ms | ActiveRecord: 1.3ms | Allocations: 1128)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------
UrlsControllerTest: test_should_return_a_list_of_URLs
-----------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.3ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "54c5ec"], ["created_at", "2023-06-11 16:30:25.771081"], ["updated_at", "2023-06-11 16:30:25.771081"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.7ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.org"], ["short_code", "b21d1f"], ["created_at", "2023-06-11 16:30:25.775539"], ["updated_at", "2023-06-11 16:30:25.775539"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/urls" for 127.0.0.1 at 2023-06-11 22:00:25 +0530
Processing by UrlsController#index as HTML
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls"[0m
Completed 200 OK in 2ms (Views: 1.0ms | ActiveRecord: 0.2ms | Allocations: 714)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------
UrlTest: test_should_not_save_an_invalid_URL
--------------------------------------------
  [1m[36mUrl Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-------------------------------------
UrlTest: test_should_save_a_valid_URL
-------------------------------------
  [1m[36mUrl Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Create (0.4ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "6a6cae"], ["created_at", "2023-06-11 16:30:25.789618"], ["updated_at", "2023-06-11 16:30:25.789618"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------
UrlTest: test_should_have_a_unique_short_code
---------------------------------------------
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (1.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.5ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "1e9e36"], ["created_at", "2023-06-11 16:30:25.797581"], ["updated_at", "2023-06-11 16:30:25.797581"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "1e9e36"], ["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "1e9e36"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.4ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "urls" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.5ms)[0m  [1m[31mDELETE FROM "urls";
INSERT INTO "urls" ("id", "original_url", "short_code", "created_at", "updated_at") VALUES (980190962, 'MyString', 'MyString', '2023-06-11 16:30:55.568870', '2023-06-11 16:30:55.568870'), (298486374, 'MyString', 'MyString', '2023-06-11 16:30:55.568870', '2023-06-11 16:30:55.568870')[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "urls" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (8.2ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------
UrlsControllerTest: test_should_return_a_list_of_URLs
-----------------------------------------------------
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", nil], ["created_at", "2023-06-11 16:30:55.701726"], ["updated_at", "2023-06-11 16:30:55.701726"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
Started GET "/urls" for 127.0.0.1 at 2023-06-11 22:00:55 +0530
Processing by UrlsController#index as HTML
  [1m[36mUrl Load (0.3ms)[0m  [1m[34mSELECT "urls".* FROM "urls"[0m
Completed 200 OK in 7ms (Views: 1.2ms | ActiveRecord: 0.3ms | Allocations: 3765)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------
UrlsControllerTest: test_should_create_a_new_URL
------------------------------------------------
Started POST "/urls" for 127.0.0.1 at 2023-06-11 22:00:55 +0530
Processing by UrlsController#create as HTML
  Parameters: {"url"=>{"original_url"=>"https://example.com"}}
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "676011"], ["created_at", "2023-06-11 16:30:55.799677"], ["updated_at", "2023-06-11 16:30:55.799677"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 3ms (Views: 0.1ms | ActiveRecord: 0.7ms | Allocations: 1143)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------
UrlsControllerTest: test_should_redirect_to_the_original_URL
------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "5d46fb"], ["created_at", "2023-06-11 16:30:55.803339"], ["updated_at", "2023-06-11 16:30:55.803339"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/5d46fb" for 127.0.0.1 at 2023-06-11 22:00:55 +0530
Processing by UrlsController#redirect as HTML
  Parameters: {"short_code"=>"5d46fb"}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "5d46fb"], ["LIMIT", 1]]
Redirected to https://example.com
Completed 302 Found in 2ms (ActiveRecord: 0.3ms | Allocations: 493)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------
UrlsControllerTest: test_should_handle_URL_not_found
----------------------------------------------------
Started GET "/invalid_short_code" for 127.0.0.1 at 2023-06-11 22:00:55 +0530
Processing by UrlsController#redirect as HTML
  Parameters: {"short_code"=>"invalid_short_code"}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "invalid_short_code"], ["LIMIT", 1]]
  Rendering text template
  Rendered text template (Duration: 0.0ms | Allocations: 8)
Completed 404 Not Found in 6ms (Views: 4.9ms | ActiveRecord: 0.2ms | Allocations: 1972)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------
UrlTest: test_should_save_a_valid_URL
-------------------------------------
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "fadd2a"], ["created_at", "2023-06-11 16:30:55.817147"], ["updated_at", "2023-06-11 16:30:55.817147"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------
UrlTest: test_should_have_a_unique_short_code
---------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "e637f8"], ["created_at", "2023-06-11 16:30:55.819752"], ["updated_at", "2023-06-11 16:30:55.819752"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "e637f8"], ["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "e637f8"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------
UrlTest: test_should_not_save_an_invalid_URL
--------------------------------------------
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.3ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "urls" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.5ms)[0m  [1m[31mDELETE FROM "urls";
INSERT INTO "urls" ("id", "original_url", "short_code", "created_at", "updated_at") VALUES (980190962, 'MyString', 'MyString', '2023-06-11 16:31:02.017164', '2023-06-11 16:31:02.017164'), (298486374, 'MyString', 'MyString', '2023-06-11 16:31:02.017164', '2023-06-11 16:31:02.017164')[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mALTER TABLE "urls" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.8ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------
UrlsControllerTest: test_should_redirect_to_the_original_URL
------------------------------------------------------------
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", nil], ["created_at", "2023-06-11 16:31:02.109907"], ["updated_at", "2023-06-11 16:31:02.109907"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/" for 127.0.0.1 at 2023-06-11 22:01:02 +0530
Processing by UrlsController#create as HTML
Completed 400 Bad Request in 4ms (ActiveRecord: 0.0ms | Allocations: 3105)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------
UrlsControllerTest: test_should_handle_URL_not_found
----------------------------------------------------
Started GET "/invalid_short_code" for 127.0.0.1 at 2023-06-11 22:01:02 +0530
Processing by UrlsController#redirect as HTML
  Parameters: {"short_code"=>"invalid_short_code"}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "invalid_short_code"], ["LIMIT", 1]]
  Rendering text template
  Rendered text template (Duration: 0.0ms | Allocations: 8)
Completed 404 Not Found in 4ms (Views: 2.3ms | ActiveRecord: 0.3ms | Allocations: 2421)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------
UrlsControllerTest: test_should_create_a_new_URL
------------------------------------------------
Started POST "/urls" for 127.0.0.1 at 2023-06-11 22:01:02 +0530
Processing by UrlsController#create as HTML
  Parameters: {"url"=>{"original_url"=>"https://example.com"}}
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "b48397"], ["created_at", "2023-06-11 16:31:02.194937"], ["updated_at", "2023-06-11 16:31:02.194937"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 3ms (Views: 0.2ms | ActiveRecord: 0.6ms | Allocations: 1157)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------
UrlsControllerTest: test_should_return_a_list_of_URLs
-----------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "a5c98d"], ["created_at", "2023-06-11 16:31:02.198121"], ["updated_at", "2023-06-11 16:31:02.198121"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.org"], ["short_code", "1e2b63"], ["created_at", "2023-06-11 16:31:02.199858"], ["updated_at", "2023-06-11 16:31:02.199858"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/urls" for 127.0.0.1 at 2023-06-11 22:01:02 +0530
Processing by UrlsController#index as HTML
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls"[0m
Completed 200 OK in 1ms (Views: 0.8ms | ActiveRecord: 0.2ms | Allocations: 743)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------
UrlTest: test_should_save_a_valid_URL
-------------------------------------
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "de2eac"], ["created_at", "2023-06-11 16:31:02.205764"], ["updated_at", "2023-06-11 16:31:02.205764"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------
UrlTest: test_should_not_save_an_invalid_URL
--------------------------------------------
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------
UrlTest: test_should_have_a_unique_short_code
---------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "edda8d"], ["created_at", "2023-06-11 16:31:02.210080"], ["updated_at", "2023-06-11 16:31:02.210080"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "edda8d"], ["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "edda8d"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.3ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "urls" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.5ms)[0m  [1m[31mDELETE FROM "urls";
INSERT INTO "urls" ("id", "original_url", "short_code", "created_at", "updated_at") VALUES (980190962, 'MyString', 'MyString', '2023-06-11 16:31:06.828509', '2023-06-11 16:31:06.828509'), (298486374, 'MyString', 'MyString', '2023-06-11 16:31:06.828509', '2023-06-11 16:31:06.828509')[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "urls" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.8ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------
UrlTest: test_should_have_a_unique_short_code
---------------------------------------------
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", nil], ["created_at", "2023-06-11 16:31:06.852598"], ["updated_at", "2023-06-11 16:31:06.852598"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------
UrlTest: test_should_not_save_an_invalid_URL
--------------------------------------------
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------
UrlTest: test_should_save_a_valid_URL
-------------------------------------
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", nil], ["created_at", "2023-06-11 16:31:06.858385"], ["updated_at", "2023-06-11 16:31:06.858385"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------
UrlsControllerTest: test_should_return_a_list_of_URLs
-----------------------------------------------------
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", nil], ["created_at", "2023-06-11 16:31:06.930640"], ["updated_at", "2023-06-11 16:31:06.930640"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
Started GET "/urls" for 127.0.0.1 at 2023-06-11 22:01:06 +0530
Processing by UrlsController#index as HTML
  [1m[36mUrl Load (0.3ms)[0m  [1m[34mSELECT "urls".* FROM "urls"[0m
Completed 200 OK in 5ms (Views: 1.2ms | ActiveRecord: 0.3ms | Allocations: 3765)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------
UrlsControllerTest: test_should_create_a_new_URL
------------------------------------------------
Started POST "/urls" for 127.0.0.1 at 2023-06-11 22:01:07 +0530
Processing by UrlsController#create as HTML
  Parameters: {"url"=>{"original_url"=>"https://example.com"}}
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "845a7f"], ["created_at", "2023-06-11 16:31:07.011184"], ["updated_at", "2023-06-11 16:31:07.011184"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 3ms (Views: 0.1ms | ActiveRecord: 0.7ms | Allocations: 1142)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------
UrlsControllerTest: test_should_handle_URL_not_found
----------------------------------------------------
Started GET "/invalid_short_code" for 127.0.0.1 at 2023-06-11 22:01:07 +0530
Processing by UrlsController#redirect as HTML
  Parameters: {"short_code"=>"invalid_short_code"}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "invalid_short_code"], ["LIMIT", 1]]
  Rendering text template
  Rendered text template (Duration: 0.0ms | Allocations: 8)
Completed 404 Not Found in 4ms (Views: 2.3ms | ActiveRecord: 0.3ms | Allocations: 2185)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------
UrlsControllerTest: test_should_redirect_to_the_original_URL
------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "747de9"], ["created_at", "2023-06-11 16:31:07.020622"], ["updated_at", "2023-06-11 16:31:07.020622"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/747de9" for 127.0.0.1 at 2023-06-11 22:01:07 +0530
Processing by UrlsController#redirect as HTML
  Parameters: {"short_code"=>"747de9"}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "747de9"], ["LIMIT", 1]]
Redirected to https://example.com
Completed 302 Found in 1ms (ActiveRecord: 0.2ms | Allocations: 308)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.3ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.3ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "urls" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.5ms)[0m  [1m[31mDELETE FROM "urls";
INSERT INTO "urls" ("id", "original_url", "short_code", "created_at", "updated_at") VALUES (980190962, 'MyString', 'MyString', '2023-06-11 16:33:30.964812', '2023-06-11 16:33:30.964812'), (298486374, 'MyString', 'MyString', '2023-06-11 16:33:30.964812', '2023-06-11 16:33:30.964812')[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "urls" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (4.4ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------
UrlsControllerTest: test_should_redirect_to_the_original_URL
------------------------------------------------------------
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", nil], ["created_at", "2023-06-11 16:33:31.080943"], ["updated_at", "2023-06-11 16:33:31.080943"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/" for 127.0.0.1 at 2023-06-11 22:03:31 +0530
Processing by UrlsController#create as HTML
Completed 400 Bad Request in 5ms (ActiveRecord: 0.0ms | Allocations: 3105)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------
UrlsControllerTest: test_should_create_a_new_URL
------------------------------------------------
Started POST "/urls" for 127.0.0.1 at 2023-06-11 22:03:31 +0530
Processing by UrlsController#create as HTML
  Parameters: {"url"=>{"original_url"=>"https://example.com"}}
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "979069"], ["created_at", "2023-06-11 16:33:31.173484"], ["updated_at", "2023-06-11 16:33:31.173484"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 3ms (Views: 0.4ms | ActiveRecord: 0.8ms | Allocations: 1241)
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------
UrlsControllerTest: test_should_handle_URL_not_found
----------------------------------------------------
Started GET "/invalid_short_code" for 127.0.0.1 at 2023-06-11 22:03:31 +0530
Processing by UrlsController#redirect as HTML
  Parameters: {"short_code"=>"invalid_short_code"}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "invalid_short_code"], ["LIMIT", 1]]
  Rendering text template
  Rendered text template (Duration: 0.0ms | Allocations: 8)
Completed 404 Not Found in 8ms (Views: 5.8ms | ActiveRecord: 0.3ms | Allocations: 2350)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------
UrlsControllerTest: test_should_return_a_list_of_URLs
-----------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "67c3f5"], ["created_at", "2023-06-11 16:33:31.190935"], ["updated_at", "2023-06-11 16:33:31.190935"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.org"], ["short_code", "16a281"], ["created_at", "2023-06-11 16:33:31.192801"], ["updated_at", "2023-06-11 16:33:31.192801"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/urls" for 127.0.0.1 at 2023-06-11 22:03:31 +0530
Processing by UrlsController#index as HTML
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls"[0m
Completed 200 OK in 2ms (Views: 0.9ms | ActiveRecord: 0.2ms | Allocations: 786)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------
UrlTest: test_should_save_a_valid_URL
-------------------------------------
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "6d094b"], ["created_at", "2023-06-11 16:33:31.199778"], ["updated_at", "2023-06-11 16:33:31.199778"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------
UrlTest: test_should_have_a_unique_short_code
---------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.3ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "6d854d"], ["created_at", "2023-06-11 16:33:31.202546"], ["updated_at", "2023-06-11 16:33:31.202546"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "6d854d"], ["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "6d854d"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------
UrlTest: test_should_not_save_an_invalid_URL
--------------------------------------------
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.3ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "urls" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.5ms)[0m  [1m[31mDELETE FROM "urls";
INSERT INTO "urls" ("id", "original_url", "short_code", "created_at", "updated_at") VALUES (980190962, 'MyString', 'MyString', '2023-06-11 16:36:16.290085', '2023-06-11 16:36:16.290085'), (298486374, 'MyString', 'MyString', '2023-06-11 16:36:16.290085', '2023-06-11 16:36:16.290085')[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mALTER TABLE "urls" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (4.7ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------
UrlTest: test_should_not_save_an_invalid_URL
--------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mUrl Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------
UrlTest: test_should_save_a_valid_URL
-------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Create (0.3ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", nil], ["created_at", "2023-06-11 16:36:16.320372"], ["updated_at", "2023-06-11 16:36:16.320372"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------
UrlTest: test_should_have_a_unique_short_code
---------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", nil], ["created_at", "2023-06-11 16:36:16.323821"], ["updated_at", "2023-06-11 16:36:16.323821"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------
UrlsControllerTest: test_should_handle_URL_not_found
----------------------------------------------------
Started GET "/invalid_short_code" for 127.0.0.1 at 2023-06-11 22:06:16 +0530
Processing by UrlsController#redirect as HTML
  Parameters: {"short_code"=>"invalid_short_code"}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "invalid_short_code"], ["LIMIT", 1]]
  Rendering text template
  Rendered text template (Duration: 0.0ms | Allocations: 8)
Completed 404 Not Found in 13ms (Views: 5.2ms | ActiveRecord: 0.4ms | Allocations: 5263)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------
UrlsControllerTest: test_should_redirect_to_the_original_URL
------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "9906e7"], ["created_at", "2023-06-11 16:36:16.516268"], ["updated_at", "2023-06-11 16:36:16.516268"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/9906e7" for 127.0.0.1 at 2023-06-11 22:06:16 +0530
Processing by UrlsController#redirect as HTML
  Parameters: {"short_code"=>"9906e7"}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "9906e7"], ["LIMIT", 1]]
Redirected to https://example.com
Completed 302 Found in 1ms (ActiveRecord: 0.2ms | Allocations: 343)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------
UrlsControllerTest: test_should_create_a_new_URL
------------------------------------------------
Started POST "/urls" for 127.0.0.1 at 2023-06-11 22:06:16 +0530
Processing by UrlsController#create as HTML
  Parameters: {"url"=>{"original_url"=>"https://example.com"}}
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.3ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "1971b0"], ["created_at", "2023-06-11 16:36:16.527640"], ["updated_at", "2023-06-11 16:36:16.527640"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 3ms (Views: 0.2ms | ActiveRecord: 0.8ms | Allocations: 1125)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------
UrlsControllerTest: test_should_return_a_list_of_URLs
-----------------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "c92f40"], ["created_at", "2023-06-11 16:36:16.531771"], ["updated_at", "2023-06-11 16:36:16.531771"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.org"], ["short_code", "ada3b7"], ["created_at", "2023-06-11 16:36:16.533459"], ["updated_at", "2023-06-11 16:36:16.533459"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/urls" for 127.0.0.1 at 2023-06-11 22:06:16 +0530
Processing by UrlsController#index as HTML
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls"[0m
Completed 200 OK in 1ms (Views: 0.7ms | ActiveRecord: 0.2ms | Allocations: 531)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.4ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "urls" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.7ms)[0m  [1m[31mDELETE FROM "urls";
INSERT INTO "urls" ("id", "original_url", "short_code", "created_at", "updated_at") VALUES (980190962, 'MyString', 'MyString', '2023-06-11 16:37:50.081665', '2023-06-11 16:37:50.081665'), (298486374, 'MyString', 'MyString', '2023-06-11 16:37:50.081665', '2023-06-11 16:37:50.081665')[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mALTER TABLE "urls" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (4.5ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------
UrlTest: test_should_save_a_valid_URL
-------------------------------------
  [1m[36mUrl Delete All (0.4ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mUrl Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", nil], ["created_at", "2023-06-11 16:37:50.111843"], ["updated_at", "2023-06-11 16:37:50.111843"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------
UrlTest: test_should_not_save_an_invalid_URL
--------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------
UrlTest: test_should_have_a_unique_short_code
---------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", nil], ["created_at", "2023-06-11 16:37:50.117900"], ["updated_at", "2023-06-11 16:37:50.117900"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------
UrlsControllerTest: test_should_redirect_to_the_original_URL
------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", nil], ["created_at", "2023-06-11 16:37:50.222713"], ["updated_at", "2023-06-11 16:37:50.222713"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/" for 127.0.0.1 at 2023-06-11 22:07:50 +0530
Processing by UrlsController#create as HTML
Completed 400 Bad Request in 6ms (ActiveRecord: 0.0ms | Allocations: 3105)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------
UrlsControllerTest: test_should_handle_URL_not_found
----------------------------------------------------
Started GET "/invalid_short_code" for 127.0.0.1 at 2023-06-11 22:07:50 +0530
Processing by UrlsController#redirect as HTML
  Parameters: {"short_code"=>"invalid_short_code"}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "invalid_short_code"], ["LIMIT", 1]]
  Rendering text template
  Rendered text template (Duration: 0.0ms | Allocations: 8)
Completed 404 Not Found in 7ms (Views: 5.1ms | ActiveRecord: 0.4ms | Allocations: 2399)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------
UrlsControllerTest: test_should_create_a_new_URL
------------------------------------------------
Started POST "/urls" for 127.0.0.1 at 2023-06-11 22:07:50 +0530
Processing by UrlsController#create as HTML
  Parameters: {"url"=>{"original_url"=>"https://example.com"}}
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "fa7377"], ["created_at", "2023-06-11 16:37:50.325523"], ["updated_at", "2023-06-11 16:37:50.325523"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 4ms (Views: 0.2ms | ActiveRecord: 0.8ms | Allocations: 1153)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------
UrlsControllerTest: test_should_return_a_list_of_URLs
-----------------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.3ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "cdbf72"], ["created_at", "2023-06-11 16:37:50.330147"], ["updated_at", "2023-06-11 16:37:50.330147"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.3ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.org"], ["short_code", "127afc"], ["created_at", "2023-06-11 16:37:50.332017"], ["updated_at", "2023-06-11 16:37:50.332017"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/urls" for 127.0.0.1 at 2023-06-11 22:07:50 +0530
Processing by UrlsController#index as HTML
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls"[0m
Completed 200 OK in 2ms (Views: 0.8ms | ActiveRecord: 0.2ms | Allocations: 560)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.3ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "urls" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.5ms)[0m  [1m[31mDELETE FROM "urls";
INSERT INTO "urls" ("id", "original_url", "short_code", "created_at", "updated_at") VALUES (980190962, 'MyString', 'MyString', '2023-06-11 16:37:57.481497', '2023-06-11 16:37:57.481497'), (298486374, 'MyString', 'MyString', '2023-06-11 16:37:57.481497', '2023-06-11 16:37:57.481497')[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "urls" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.9ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------
UrlTest: test_should_have_a_unique_short_code
---------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", nil], ["created_at", "2023-06-11 16:37:57.505408"], ["updated_at", "2023-06-11 16:37:57.505408"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------
UrlTest: test_should_not_save_an_invalid_URL
--------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------
UrlTest: test_should_save_a_valid_URL
-------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", nil], ["created_at", "2023-06-11 16:37:57.513040"], ["updated_at", "2023-06-11 16:37:57.513040"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------
UrlsControllerTest: test_should_return_a_list_of_URLs
-----------------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", nil], ["created_at", "2023-06-11 16:37:57.590146"], ["updated_at", "2023-06-11 16:37:57.590146"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
Started GET "/urls" for 127.0.0.1 at 2023-06-11 22:07:57 +0530
Processing by UrlsController#index as HTML
  [1m[36mUrl Load (0.3ms)[0m  [1m[34mSELECT "urls".* FROM "urls"[0m
Completed 200 OK in 5ms (Views: 1.0ms | ActiveRecord: 0.3ms | Allocations: 3563)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------
UrlsControllerTest: test_should_create_a_new_URL
------------------------------------------------
Started POST "/urls" for 127.0.0.1 at 2023-06-11 22:07:57 +0530
Processing by UrlsController#create as HTML
  Parameters: {"url"=>{"original_url"=>"https://example.com"}}
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "b0058a"], ["created_at", "2023-06-11 16:37:57.672925"], ["updated_at", "2023-06-11 16:37:57.672925"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 3ms (Views: 0.1ms | ActiveRecord: 0.6ms | Allocations: 1142)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------
UrlsControllerTest: test_should_handle_URL_not_found
----------------------------------------------------
Started GET "/invalid_short_code" for 127.0.0.1 at 2023-06-11 22:07:57 +0530
Processing by UrlsController#redirect as HTML
  Parameters: {"short_code"=>"invalid_short_code"}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "invalid_short_code"], ["LIMIT", 1]]
  Rendering text template
  Rendered text template (Duration: 0.0ms | Allocations: 8)
Completed 404 Not Found in 4ms (Views: 2.2ms | ActiveRecord: 0.3ms | Allocations: 2184)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------
UrlsControllerTest: test_should_redirect_to_the_original_URL
------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "8d193e"], ["created_at", "2023-06-11 16:37:57.681951"], ["updated_at", "2023-06-11 16:37:57.681951"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/8d193e" for 127.0.0.1 at 2023-06-11 22:07:57 +0530
Processing by UrlsController#redirect as HTML
  Parameters: {"short_code"=>"8d193e"}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "8d193e"], ["LIMIT", 1]]
Redirected to https://example.com
Completed 302 Found in 1ms (ActiveRecord: 0.2ms | Allocations: 308)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.3ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "urls" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.5ms)[0m  [1m[31mDELETE FROM "urls";
INSERT INTO "urls" ("id", "original_url", "short_code", "created_at", "updated_at") VALUES (980190962, 'MyString', 'MyString', '2023-06-11 16:38:02.382704', '2023-06-11 16:38:02.382704'), (298486374, 'MyString', 'MyString', '2023-06-11 16:38:02.382704', '2023-06-11 16:38:02.382704')[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "urls" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.8ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------
UrlsControllerTest: test_should_handle_URL_not_found
----------------------------------------------------
Started GET "/invalid_short_code" for 127.0.0.1 at 2023-06-11 22:08:02 +0530
Processing by UrlsController#redirect as HTML
  Parameters: {"short_code"=>"invalid_short_code"}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "invalid_short_code"], ["LIMIT", 1]]
  Rendering text template
  Rendered text template (Duration: 0.0ms | Allocations: 8)
Completed 404 Not Found in 8ms (Views: 2.3ms | ActiveRecord: 0.4ms | Allocations: 5453)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------
UrlsControllerTest: test_should_redirect_to_the_original_URL
------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "56df15"], ["created_at", "2023-06-11 16:38:02.553269"], ["updated_at", "2023-06-11 16:38:02.553269"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/56df15" for 127.0.0.1 at 2023-06-11 22:08:02 +0530
Processing by UrlsController#redirect as HTML
  Parameters: {"short_code"=>"56df15"}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "56df15"], ["LIMIT", 1]]
Redirected to https://example.com
Completed 302 Found in 1ms (ActiveRecord: 0.2ms | Allocations: 343)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------
UrlsControllerTest: test_should_create_a_new_URL
------------------------------------------------
Started POST "/urls" for 127.0.0.1 at 2023-06-11 22:08:02 +0530
Processing by UrlsController#create as HTML
  Parameters: {"url"=>{"original_url"=>"https://example.com"}}
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "f72720"], ["created_at", "2023-06-11 16:38:02.562521"], ["updated_at", "2023-06-11 16:38:02.562521"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 3ms (Views: 0.2ms | ActiveRecord: 0.6ms | Allocations: 1128)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------
UrlsControllerTest: test_should_return_a_list_of_URLs
-----------------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "9fde69"], ["created_at", "2023-06-11 16:38:02.565971"], ["updated_at", "2023-06-11 16:38:02.565971"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.org"], ["short_code", "95b8bc"], ["created_at", "2023-06-11 16:38:02.567469"], ["updated_at", "2023-06-11 16:38:02.567469"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/urls" for 127.0.0.1 at 2023-06-11 22:08:02 +0530
Processing by UrlsController#index as HTML
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls"[0m
Completed 200 OK in 1ms (Views: 0.6ms | ActiveRecord: 0.2ms | Allocations: 531)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------
UrlTest: test_should_not_save_an_invalid_URL
--------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------
UrlTest: test_should_save_a_valid_URL
-------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "b7381c"], ["created_at", "2023-06-11 16:38:02.575553"], ["updated_at", "2023-06-11 16:38:02.575553"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------
UrlTest: test_should_have_a_unique_short_code
---------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "939a21"], ["created_at", "2023-06-11 16:38:02.578493"], ["updated_at", "2023-06-11 16:38:02.578493"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "939a21"], ["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "939a21"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.3ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "urls" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.5ms)[0m  [1m[31mDELETE FROM "urls";
INSERT INTO "urls" ("id", "original_url", "short_code", "created_at", "updated_at") VALUES (980190962, 'MyString', 'MyString', '2023-06-11 16:38:25.428714', '2023-06-11 16:38:25.428714'), (298486374, 'MyString', 'MyString', '2023-06-11 16:38:25.428714', '2023-06-11 16:38:25.428714')[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mALTER TABLE "urls" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.8ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------
UrlTest: test_should_not_save_an_invalid_URL
--------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mUrl Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------
UrlTest: test_should_save_a_valid_URL
-------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mUrl Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Create (0.3ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", nil], ["created_at", "2023-06-11 16:38:25.455400"], ["updated_at", "2023-06-11 16:38:25.455400"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------
UrlTest: test_should_have_a_unique_short_code
---------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", nil], ["created_at", "2023-06-11 16:38:25.459376"], ["updated_at", "2023-06-11 16:38:25.459376"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------
UrlsControllerTest: test_should_redirect_to_the_original_URL
------------------------------------------------------------
  [1m[36mUrl Delete All (0.3ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", nil], ["created_at", "2023-06-11 16:38:25.537062"], ["updated_at", "2023-06-11 16:38:25.537062"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/" for 127.0.0.1 at 2023-06-11 22:08:25 +0530
Processing by UrlsController#create as HTML
Completed 400 Bad Request in 4ms (ActiveRecord: 0.0ms | Allocations: 3105)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------
UrlsControllerTest: test_should_handle_URL_not_found
----------------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
Started GET "/invalid_short_code" for 127.0.0.1 at 2023-06-11 22:08:25 +0530
Processing by UrlsController#redirect as HTML
  Parameters: {"short_code"=>"invalid_short_code"}
  [1m[36mUrl Load (0.3ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "invalid_short_code"], ["LIMIT", 1]]
  Rendering text template
  Rendered text template (Duration: 0.0ms | Allocations: 8)
Completed 404 Not Found in 4ms (Views: 2.3ms | ActiveRecord: 0.4ms | Allocations: 2367)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------
UrlsControllerTest: test_should_return_a_list_of_URLs
-----------------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mUrl Delete All (0.1ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "d13a13"], ["created_at", "2023-06-11 16:38:25.621209"], ["updated_at", "2023-06-11 16:38:25.621209"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.org"], ["short_code", "205ec5"], ["created_at", "2023-06-11 16:38:25.622903"], ["updated_at", "2023-06-11 16:38:25.622903"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/urls" for 127.0.0.1 at 2023-06-11 22:08:25 +0530
Processing by UrlsController#index as HTML
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls"[0m
Completed 200 OK in 1ms (Views: 0.7ms | ActiveRecord: 0.2ms | Allocations: 638)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------
UrlsControllerTest: test_should_create_a_new_URL
------------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
Started POST "/urls" for 127.0.0.1 at 2023-06-11 22:08:25 +0530
Processing by UrlsController#create as HTML
  Parameters: {"url"=>{"original_url"=>"https://example.com"}}
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "8c23c8"], ["created_at", "2023-06-11 16:38:25.632321"], ["updated_at", "2023-06-11 16:38:25.632321"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 2ms (Views: 0.1ms | ActiveRecord: 0.7ms | Allocations: 1100)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.3ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "urls" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.5ms)[0m  [1m[31mDELETE FROM "urls";
INSERT INTO "urls" ("id", "original_url", "short_code", "created_at", "updated_at") VALUES (980190962, 'MyString', 'MyString', '2023-06-11 16:38:33.295276', '2023-06-11 16:38:33.295276'), (298486374, 'MyString', 'MyString', '2023-06-11 16:38:33.295276', '2023-06-11 16:38:33.295276')[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "urls" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (3.0ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------
UrlTest: test_should_not_save_an_invalid_URL
--------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mUrl Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-------------------------------------
UrlTest: test_should_save_a_valid_URL
-------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Create (0.3ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", nil], ["created_at", "2023-06-11 16:38:33.323576"], ["updated_at", "2023-06-11 16:38:33.323576"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------
UrlTest: test_should_have_a_unique_short_code
---------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", nil], ["created_at", "2023-06-11 16:38:33.327420"], ["updated_at", "2023-06-11 16:38:33.327420"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------
UrlsControllerTest: test_should_handle_URL_not_found
----------------------------------------------------
  [1m[36mUrl Delete All (0.3ms)[0m  [1m[31mDELETE FROM "urls"[0m
Started GET "/invalid_short_code" for 127.0.0.1 at 2023-06-11 22:08:33 +0530
Processing by UrlsController#redirect as HTML
  Parameters: {"short_code"=>"invalid_short_code"}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "invalid_short_code"], ["LIMIT", 1]]
  Rendering text template
  Rendered text template (Duration: 0.0ms | Allocations: 8)
Completed 404 Not Found in 7ms (Views: 2.2ms | ActiveRecord: 0.4ms | Allocations: 5259)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------
UrlsControllerTest: test_should_return_a_list_of_URLs
-----------------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mUrl Delete All (0.1ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "c66703"], ["created_at", "2023-06-11 16:38:33.487124"], ["updated_at", "2023-06-11 16:38:33.487124"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.org"], ["short_code", "307d56"], ["created_at", "2023-06-11 16:38:33.488787"], ["updated_at", "2023-06-11 16:38:33.488787"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/urls" for 127.0.0.1 at 2023-06-11 22:08:33 +0530
Processing by UrlsController#index as HTML
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls"[0m
Completed 200 OK in 1ms (Views: 0.7ms | ActiveRecord: 0.2ms | Allocations: 638)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------
UrlsControllerTest: test_should_redirect_to_the_original_URL
------------------------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "ecfd4e"], ["created_at", "2023-06-11 16:38:33.494389"], ["updated_at", "2023-06-11 16:38:33.494389"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/ecfd4e" for 127.0.0.1 at 2023-06-11 22:08:33 +0530
Processing by UrlsController#redirect as HTML
  Parameters: {"short_code"=>"ecfd4e"}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "ecfd4e"], ["LIMIT", 1]]
Redirected to https://example.com
Completed 302 Found in 1ms (ActiveRecord: 0.2ms | Allocations: 296)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------
UrlsControllerTest: test_should_create_a_new_URL
------------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
Started POST "/urls" for 127.0.0.1 at 2023-06-11 22:08:33 +0530
Processing by UrlsController#create as HTML
  Parameters: {"url"=>{"original_url"=>"https://example.com"}}
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "dd340e"], ["created_at", "2023-06-11 16:38:33.503080"], ["updated_at", "2023-06-11 16:38:33.503080"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 2ms (Views: 0.1ms | ActiveRecord: 0.6ms | Allocations: 1102)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.3ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "urls" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.5ms)[0m  [1m[31mDELETE FROM "urls";
INSERT INTO "urls" ("id", "original_url", "short_code", "created_at", "updated_at") VALUES (980190962, 'MyString', 'MyString', '2023-06-11 16:38:36.717989', '2023-06-11 16:38:36.717989'), (298486374, 'MyString', 'MyString', '2023-06-11 16:38:36.717989', '2023-06-11 16:38:36.717989')[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "urls" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.8ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------
UrlsControllerTest: test_should_return_a_list_of_URLs
-----------------------------------------------------
  [1m[36mUrl Delete All (0.3ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mUrl Delete All (0.1ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.3ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", nil], ["created_at", "2023-06-11 16:38:36.812151"], ["updated_at", "2023-06-11 16:38:36.812151"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
Started GET "/urls" for 127.0.0.1 at 2023-06-11 22:08:36 +0530
Processing by UrlsController#index as HTML
  [1m[36mUrl Load (0.3ms)[0m  [1m[34mSELECT "urls".* FROM "urls"[0m
Completed 200 OK in 5ms (Views: 0.9ms | ActiveRecord: 0.3ms | Allocations: 3563)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------
UrlsControllerTest: test_should_create_a_new_URL
------------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
Started POST "/urls" for 127.0.0.1 at 2023-06-11 22:08:36 +0530
Processing by UrlsController#create as HTML
  Parameters: {"url"=>{"original_url"=>"https://example.com"}}
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "bf53b2"], ["created_at", "2023-06-11 16:38:36.893679"], ["updated_at", "2023-06-11 16:38:36.893679"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 3ms (Views: 0.1ms | ActiveRecord: 0.6ms | Allocations: 1143)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------
UrlsControllerTest: test_should_redirect_to_the_original_URL
------------------------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "e4063b"], ["created_at", "2023-06-11 16:38:36.897178"], ["updated_at", "2023-06-11 16:38:36.897178"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/e4063b" for 127.0.0.1 at 2023-06-11 22:08:36 +0530
Processing by UrlsController#redirect as HTML
  Parameters: {"short_code"=>"e4063b"}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "e4063b"], ["LIMIT", 1]]
Redirected to https://example.com
Completed 302 Found in 2ms (ActiveRecord: 0.3ms | Allocations: 490)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------
UrlsControllerTest: test_should_handle_URL_not_found
----------------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
Started GET "/invalid_short_code" for 127.0.0.1 at 2023-06-11 22:08:36 +0530
Processing by UrlsController#redirect as HTML
  Parameters: {"short_code"=>"invalid_short_code"}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "invalid_short_code"], ["LIMIT", 1]]
  Rendering text template
  Rendered text template (Duration: 0.0ms | Allocations: 8)
Completed 404 Not Found in 3ms (Views: 2.2ms | ActiveRecord: 0.2ms | Allocations: 1972)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------
UrlTest: test_should_save_a_valid_URL
-------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "dd3e1d"], ["created_at", "2023-06-11 16:38:36.909063"], ["updated_at", "2023-06-11 16:38:36.909063"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------
UrlTest: test_should_have_a_unique_short_code
---------------------------------------------
  [1m[36mUrl Delete All (0.3ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "a96de3"], ["created_at", "2023-06-11 16:38:36.911954"], ["updated_at", "2023-06-11 16:38:36.911954"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "a96de3"], ["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "a96de3"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------
UrlTest: test_should_not_save_an_invalid_URL
--------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.4ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "urls" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.5ms)[0m  [1m[31mDELETE FROM "urls";
INSERT INTO "urls" ("id", "original_url", "short_code", "created_at", "updated_at") VALUES (980190962, 'MyString', 'MyString', '2023-06-11 16:39:38.257799', '2023-06-11 16:39:38.257799'), (298486374, 'MyString', 'MyString', '2023-06-11 16:39:38.257799', '2023-06-11 16:39:38.257799')[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mALTER TABLE "urls" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (4.3ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------
UrlTest: test_should_not_save_an_invalid_URL
--------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mUrl Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------
UrlTest: test_should_have_a_unique_short_code
---------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", nil], ["created_at", "2023-06-11 16:39:38.286331"], ["updated_at", "2023-06-11 16:39:38.286331"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------
UrlTest: test_should_save_a_valid_URL
-------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", nil], ["created_at", "2023-06-11 16:39:38.290446"], ["updated_at", "2023-06-11 16:39:38.290446"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------
UrlsControllerTest: test_should_create_a_new_URL
------------------------------------------------
  [1m[36mUrl Delete All (0.3ms)[0m  [1m[31mDELETE FROM "urls"[0m
Started POST "/urls" for 127.0.0.1 at 2023-06-11 22:09:38 +0530
Processing by UrlsController#create as HTML
  Parameters: {"url"=>{"original_url"=>"https://example.com"}}
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "0358ad"], ["created_at", "2023-06-11 16:39:38.473960"], ["updated_at", "2023-06-11 16:39:38.473960"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 7ms (Views: 0.2ms | ActiveRecord: 0.7ms | Allocations: 4063)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------
UrlsControllerTest: test_should_handle_URL_not_found
----------------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
Started GET "/invalid_short_code" for 127.0.0.1 at 2023-06-11 22:09:38 +0530
Processing by UrlsController#redirect as HTML
  Parameters: {"short_code"=>"invalid_short_code"}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "invalid_short_code"], ["LIMIT", 1]]
  Rendering text template
  Rendered text template (Duration: 0.0ms | Allocations: 8)
Completed 404 Not Found in 7ms (Views: 4.7ms | ActiveRecord: 0.4ms | Allocations: 2354)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------
UrlsControllerTest: test_should_return_a_list_of_URLs
-----------------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "18e543"], ["created_at", "2023-06-11 16:39:38.492310"], ["updated_at", "2023-06-11 16:39:38.492310"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.org"], ["short_code", "1ed9ec"], ["created_at", "2023-06-11 16:39:38.494195"], ["updated_at", "2023-06-11 16:39:38.494195"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/urls" for 127.0.0.1 at 2023-06-11 22:09:38 +0530
Processing by UrlsController#index as HTML
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls"[0m
Completed 200 OK in 1ms (Views: 0.7ms | ActiveRecord: 0.2ms | Allocations: 603)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------
UrlsControllerTest: test_should_redirect_to_the_original_URL
------------------------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "452cf4"], ["created_at", "2023-06-11 16:39:38.500276"], ["updated_at", "2023-06-11 16:39:38.500276"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/452cf4" for 127.0.0.1 at 2023-06-11 22:09:38 +0530
Processing by UrlsController#redirect as HTML
  Parameters: {"short_code"=>"452cf4"}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "452cf4"], ["LIMIT", 1]]
Redirected to https://example.com
Completed 302 Found in 1ms (ActiveRecord: 0.2ms | Allocations: 296)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.4ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mALTER TABLE "urls" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.7ms)[0m  [1m[31mDELETE FROM "urls";
INSERT INTO "urls" ("id", "original_url", "short_code", "created_at", "updated_at") VALUES (980190962, 'MyString', 'MyString', '2023-06-11 16:42:16.427390', '2023-06-11 16:42:16.427390'), (298486374, 'MyString', 'MyString', '2023-06-11 16:42:16.427390', '2023-06-11 16:42:16.427390')[0m
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mALTER TABLE "urls" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (3.6ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------
UrlsControllerTest: test_should_handle_URL_not_found
----------------------------------------------------
  [1m[36mUrl Delete All (0.3ms)[0m  [1m[31mDELETE FROM "urls"[0m
Started GET "/invalid_short_code" for 127.0.0.1 at 2023-06-11 22:12:16 +0530
Processing by UrlsController#redirect as HTML
  Parameters: {"short_code"=>"invalid_short_code"}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "invalid_short_code"], ["LIMIT", 1]]
  Rendering text template
  Rendered text template (Duration: 0.0ms | Allocations: 8)
Completed 404 Not Found in 8ms (Views: 2.6ms | ActiveRecord: 0.4ms | Allocations: 5354)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------
UrlsControllerTest: test_should_create_a_new_URL
------------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
Started POST "/urls" for 127.0.0.1 at 2023-06-11 22:12:16 +0530
Processing by UrlsController#create as HTML
  Parameters: {"url"=>{"original_url"=>"https://example.com"}}
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.3ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "2ea33a"], ["created_at", "2023-06-11 16:42:16.609498"], ["updated_at", "2023-06-11 16:42:16.609498"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 12ms (Views: 0.2ms | ActiveRecord: 0.7ms | Allocations: 16878)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------
UrlsControllerTest: test_should_redirect_to_the_original_URL
------------------------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "a96206"], ["created_at", "2023-06-11 16:42:16.614035"], ["updated_at", "2023-06-11 16:42:16.614035"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/a96206" for 127.0.0.1 at 2023-06-11 22:12:16 +0530
Processing by UrlsController#redirect as HTML
  Parameters: {"short_code"=>"a96206"}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "a96206"], ["LIMIT", 1]]
Redirected to https://example.com
Completed 302 Found in 1ms (ActiveRecord: 0.2ms | Allocations: 338)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------
UrlsControllerTest: test_should_return_a_list_of_URLs
-----------------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "859077"], ["created_at", "2023-06-11 16:42:16.619790"], ["updated_at", "2023-06-11 16:42:16.619790"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.org"], ["short_code", "e1fe33"], ["created_at", "2023-06-11 16:42:16.621385"], ["updated_at", "2023-06-11 16:42:16.621385"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/urls" for 127.0.0.1 at 2023-06-11 22:12:16 +0530
Processing by UrlsController#index as HTML
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls"[0m
Completed 200 OK in 1ms (Views: 0.6ms | ActiveRecord: 0.2ms | Allocations: 528)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------
UrlTest: test_should_not_save_an_invalid_URL
--------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------
UrlTest: test_should_have_a_unique_short_code
---------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "7f64e9"], ["created_at", "2023-06-11 16:42:16.629737"], ["updated_at", "2023-06-11 16:42:16.629737"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "7f64e9"], ["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "7f64e9"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------
UrlTest: test_should_save_a_valid_URL
-------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mUrl Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "0141fc"], ["created_at", "2023-06-11 16:42:16.633947"], ["updated_at", "2023-06-11 16:42:16.633947"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.3ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "urls" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.6ms)[0m  [1m[31mDELETE FROM "urls";
INSERT INTO "urls" ("id", "original_url", "short_code", "created_at", "updated_at") VALUES (980190962, 'MyString', 'MyString', '2023-06-11 16:42:21.076170', '2023-06-11 16:42:21.076170'), (298486374, 'MyString', 'MyString', '2023-06-11 16:42:21.076170', '2023-06-11 16:42:21.076170')[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "urls" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.8ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------
UrlTest: test_should_have_a_unique_short_code
---------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", nil], ["created_at", "2023-06-11 16:42:21.099594"], ["updated_at", "2023-06-11 16:42:21.099594"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------
UrlTest: test_should_save_a_valid_URL
-------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", nil], ["created_at", "2023-06-11 16:42:21.105661"], ["updated_at", "2023-06-11 16:42:21.105661"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------
UrlTest: test_should_not_save_an_invalid_URL
--------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------
UrlsControllerTest: test_should_create_a_new_URL
------------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
Started POST "/urls" for 127.0.0.1 at 2023-06-11 22:12:21 +0530
Processing by UrlsController#create as HTML
  Parameters: {"url"=>{"original_url"=>"https://example.com"}}
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "88fa51"], ["created_at", "2023-06-11 16:42:21.258315"], ["updated_at", "2023-06-11 16:42:21.258315"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 6ms (Views: 0.2ms | ActiveRecord: 0.7ms | Allocations: 4063)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------
UrlsControllerTest: test_should_return_a_list_of_URLs
-----------------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "94d5a3"], ["created_at", "2023-06-11 16:42:21.263715"], ["updated_at", "2023-06-11 16:42:21.263715"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.org"], ["short_code", "698684"], ["created_at", "2023-06-11 16:42:21.265270"], ["updated_at", "2023-06-11 16:42:21.265270"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/urls" for 127.0.0.1 at 2023-06-11 22:12:21 +0530
Processing by UrlsController#index as HTML
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls"[0m
Completed 200 OK in 1ms (Views: 0.8ms | ActiveRecord: 0.2ms | Allocations: 742)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------
UrlsControllerTest: test_should_redirect_to_the_original_URL
------------------------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "12dea0"], ["created_at", "2023-06-11 16:42:21.272562"], ["updated_at", "2023-06-11 16:42:21.272562"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/12dea0" for 127.0.0.1 at 2023-06-11 22:12:21 +0530
Processing by UrlsController#redirect as HTML
  Parameters: {"short_code"=>"12dea0"}
  [1m[36mUrl Load (0.1ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "12dea0"], ["LIMIT", 1]]
Redirected to https://example.com
Completed 302 Found in 1ms (ActiveRecord: 0.3ms | Allocations: 490)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------
UrlsControllerTest: test_should_handle_URL_not_found
----------------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
Started GET "/invalid_short_code" for 127.0.0.1 at 2023-06-11 22:12:21 +0530
Processing by UrlsController#redirect as HTML
  Parameters: {"short_code"=>"invalid_short_code"}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "invalid_short_code"], ["LIMIT", 1]]
  Rendering text template
  Rendered text template (Duration: 0.0ms | Allocations: 8)
Completed 404 Not Found in 3ms (Views: 2.4ms | ActiveRecord: 0.2ms | Allocations: 1971)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.3ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "urls" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.5ms)[0m  [1m[31mDELETE FROM "urls";
INSERT INTO "urls" ("id", "original_url", "short_code", "created_at", "updated_at") VALUES (980190962, 'MyString', 'MyString', '2023-06-11 16:47:58.801889', '2023-06-11 16:47:58.801889'), (298486374, 'MyString', 'MyString', '2023-06-11 16:47:58.801889', '2023-06-11 16:47:58.801889')[0m
  [1m[36mTRANSACTION (2.7ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mALTER TABLE "urls" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (4.8ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------
UrlTest: test_should_save_a_valid_URL
-------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mUrl Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Create (0.3ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", nil], ["created_at", "2023-06-11 16:47:58.836750"], ["updated_at", "2023-06-11 16:47:58.836750"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------
UrlTest: test_should_have_a_unique_short_code
---------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.3ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", nil], ["created_at", "2023-06-11 16:47:58.841633"], ["updated_at", "2023-06-11 16:47:58.841633"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------
UrlTest: test_should_not_save_an_invalid_URL
--------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------
UrlsControllerTest: test_should_redirect_to_the_original_URL
------------------------------------------------------------
  [1m[36mUrl Delete All (0.3ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", nil], ["created_at", "2023-06-11 16:47:58.966331"], ["updated_at", "2023-06-11 16:47:58.966331"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/" for 127.0.0.1 at 2023-06-11 22:17:58 +0530
Processing by UrlsController#create as HTML
Completed 400 Bad Request in 5ms (ActiveRecord: 0.0ms | Allocations: 3256)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------
UrlsControllerTest: test_should_create_a_new_URL
------------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
Started POST "/urls" for 127.0.0.1 at 2023-06-11 22:17:59 +0530
Processing by UrlsController#create as HTML
  Parameters: {"url"=>{"original_url"=>"https://example.com"}}
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "c0b88d"], ["created_at", "2023-06-11 16:47:59.068085"], ["updated_at", "2023-06-11 16:47:59.068085"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 4ms (Views: 0.7ms | ActiveRecord: 0.8ms | Allocations: 1242)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------
UrlsControllerTest: test_should_handle_URL_not_found
----------------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
Started GET "/invalid_short_code" for 127.0.0.1 at 2023-06-11 22:17:59 +0530
Processing by UrlsController#redirect as HTML
  Parameters: {"short_code"=>"invalid_short_code"}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "invalid_short_code"], ["LIMIT", 1]]
  Rendering text template
  Rendered text template (Duration: 0.0ms | Allocations: 8)
Completed 404 Not Found in 6ms (Views: 4.4ms | ActiveRecord: 0.3ms | Allocations: 2514)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------
UrlsControllerTest: test_should_return_a_list_of_URLs
-----------------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "18659f"], ["created_at", "2023-06-11 16:47:59.085426"], ["updated_at", "2023-06-11 16:47:59.085426"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.org"], ["short_code", "5b0a70"], ["created_at", "2023-06-11 16:47:59.087517"], ["updated_at", "2023-06-11 16:47:59.087517"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/urls" for 127.0.0.1 at 2023-06-11 22:17:59 +0530
Processing by UrlsController#index as HTML
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls"[0m
Completed 200 OK in 2ms (Views: 0.9ms | ActiveRecord: 0.2ms | Allocations: 603)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.3ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "urls" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.5ms)[0m  [1m[31mDELETE FROM "urls";
INSERT INTO "urls" ("id", "original_url", "short_code", "created_at", "updated_at") VALUES (980190962, 'MyString', 'MyString', '2023-06-11 16:48:32.860007', '2023-06-11 16:48:32.860007'), (298486374, 'MyString', 'MyString', '2023-06-11 16:48:32.860007', '2023-06-11 16:48:32.860007')[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mALTER TABLE "urls" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (4.6ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------
UrlsControllerTest: test_should_return_a_list_of_URLs
-----------------------------------------------------
  [1m[36mUrl Delete All (0.3ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", nil], ["created_at", "2023-06-11 16:48:33.008337"], ["updated_at", "2023-06-11 16:48:33.008337"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
Started GET "/urls" for 127.0.0.1 at 2023-06-11 22:18:33 +0530
Processing by UrlsController#index as HTML
  [1m[36mUrl Load (0.3ms)[0m  [1m[34mSELECT "urls".* FROM "urls"[0m
Completed 200 OK in 7ms (Views: 1.4ms | ActiveRecord: 0.3ms | Allocations: 3717)
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------
UrlsControllerTest: test_should_redirect_to_the_original_URL
------------------------------------------------------------
  [1m[36mUrl Delete All (0.3ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "f862af"], ["created_at", "2023-06-11 16:48:33.129147"], ["updated_at", "2023-06-11 16:48:33.129147"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/f862af" for 127.0.0.1 at 2023-06-11 22:18:33 +0530
Processing by UrlsController#redirect as HTML
  Parameters: {"short_code"=>"f862af"}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "f862af"], ["LIMIT", 1]]
Redirected to https://example.com
Completed 302 Found in 2ms (ActiveRecord: 0.3ms | Allocations: 518)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------
UrlsControllerTest: test_should_handle_URL_not_found
----------------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
Started GET "/invalid_short_code" for 127.0.0.1 at 2023-06-11 22:18:33 +0530
Processing by UrlsController#redirect as HTML
  Parameters: {"short_code"=>"invalid_short_code"}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "invalid_short_code"], ["LIMIT", 1]]
  Rendering text template
  Rendered text template (Duration: 0.0ms | Allocations: 8)
Completed 404 Not Found in 5ms (Views: 4.5ms | ActiveRecord: 0.2ms | Allocations: 2202)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------
UrlsControllerTest: test_should_create_a_new_URL
------------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
Started POST "/urls" for 127.0.0.1 at 2023-06-11 22:18:33 +0530
Processing by UrlsController#create as HTML
  Parameters: {"url"=>{"original_url"=>"https://example.com"}}
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "f612af"], ["created_at", "2023-06-11 16:48:33.152432"], ["updated_at", "2023-06-11 16:48:33.152432"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 3ms (Views: 0.2ms | ActiveRecord: 0.7ms | Allocations: 1102)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------
UrlTest: test_should_save_a_valid_URL
-------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "81f513"], ["created_at", "2023-06-11 16:48:33.157905"], ["updated_at", "2023-06-11 16:48:33.157905"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------
UrlTest: test_should_not_save_an_invalid_URL
--------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------
UrlTest: test_should_have_a_unique_short_code
---------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "eca80f"], ["created_at", "2023-06-11 16:48:33.164196"], ["updated_at", "2023-06-11 16:48:33.164196"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "eca80f"], ["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "eca80f"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.2ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "urls" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.5ms)[0m  [1m[31mDELETE FROM "urls";
INSERT INTO "urls" ("id", "original_url", "short_code", "created_at", "updated_at") VALUES (980190962, 'MyString', 'MyString', '2023-06-11 16:48:37.068044', '2023-06-11 16:48:37.068044'), (298486374, 'MyString', 'MyString', '2023-06-11 16:48:37.068044', '2023-06-11 16:48:37.068044')[0m
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "urls" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.9ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------
UrlTest: test_should_have_a_unique_short_code
---------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", nil], ["created_at", "2023-06-11 16:48:37.094103"], ["updated_at", "2023-06-11 16:48:37.094103"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------
UrlTest: test_should_not_save_an_invalid_URL
--------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------
UrlTest: test_should_save_a_valid_URL
-------------------------------------
  [1m[36mUrl Delete All (0.3ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", nil], ["created_at", "2023-06-11 16:48:37.102931"], ["updated_at", "2023-06-11 16:48:37.102931"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------
UrlsControllerTest: test_should_return_a_list_of_URLs
-----------------------------------------------------
  [1m[36mUrl Delete All (0.3ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", nil], ["created_at", "2023-06-11 16:48:37.203931"], ["updated_at", "2023-06-11 16:48:37.203931"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
Started GET "/urls" for 127.0.0.1 at 2023-06-11 22:18:37 +0530
Processing by UrlsController#index as HTML
  [1m[36mUrl Load (0.3ms)[0m  [1m[34mSELECT "urls".* FROM "urls"[0m
Completed 200 OK in 6ms (Views: 1.0ms | ActiveRecord: 0.3ms | Allocations: 3717)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------
UrlsControllerTest: test_should_handle_URL_not_found
----------------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
Started GET "/invalid_short_code" for 127.0.0.1 at 2023-06-11 22:18:37 +0530
Processing by UrlsController#redirect as HTML
  Parameters: {"short_code"=>"invalid_short_code"}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "invalid_short_code"], ["LIMIT", 1]]
  Rendering text template
  Rendered text template (Duration: 0.0ms | Allocations: 8)
Completed 404 Not Found in 5ms (Views: 3.3ms | ActiveRecord: 0.3ms | Allocations: 2490)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------
UrlsControllerTest: test_should_create_a_new_URL
------------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
Started POST "/urls" for 127.0.0.1 at 2023-06-11 22:18:37 +0530
Processing by UrlsController#create as HTML
  Parameters: {"url"=>{"original_url"=>"https://example.com"}}
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "958f01"], ["created_at", "2023-06-11 16:48:37.311039"], ["updated_at", "2023-06-11 16:48:37.311039"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 3ms (Views: 0.2ms | ActiveRecord: 0.6ms | Allocations: 1129)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------
UrlsControllerTest: test_should_redirect_to_the_original_URL
------------------------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "172baf"], ["created_at", "2023-06-11 16:48:37.315136"], ["updated_at", "2023-06-11 16:48:37.315136"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/172baf" for 127.0.0.1 at 2023-06-11 22:18:37 +0530
Processing by UrlsController#redirect as HTML
  Parameters: {"short_code"=>"172baf"}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "172baf"], ["LIMIT", 1]]
Redirected to https://example.com
Completed 302 Found in 1ms (ActiveRecord: 0.2ms | Allocations: 297)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.3ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "urls" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.5ms)[0m  [1m[31mDELETE FROM "urls";
INSERT INTO "urls" ("id", "original_url", "short_code", "created_at", "updated_at") VALUES (980190962, 'MyString', 'MyString', '2023-06-11 16:48:45.039569', '2023-06-11 16:48:45.039569'), (298486374, 'MyString', 'MyString', '2023-06-11 16:48:45.039569', '2023-06-11 16:48:45.039569')[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "urls" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.9ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------
UrlTest: test_should_have_a_unique_short_code
---------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", nil], ["created_at", "2023-06-11 16:48:45.065169"], ["updated_at", "2023-06-11 16:48:45.065169"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------
UrlTest: test_should_not_save_an_invalid_URL
--------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------
UrlTest: test_should_save_a_valid_URL
-------------------------------------
  [1m[36mUrl Delete All (0.3ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", nil], ["created_at", "2023-06-11 16:48:45.074247"], ["updated_at", "2023-06-11 16:48:45.074247"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------
UrlsControllerTest: test_should_create_a_new_URL
------------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
Started POST "/urls" for 127.0.0.1 at 2023-06-11 22:18:45 +0530
Processing by UrlsController#create as HTML
  Parameters: {"url"=>{"original_url"=>"https://example.com"}}
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "c94534"], ["created_at", "2023-06-11 16:48:45.255113"], ["updated_at", "2023-06-11 16:48:45.255113"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 7ms (Views: 0.3ms | ActiveRecord: 0.7ms | Allocations: 4218)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------
UrlsControllerTest: test_should_return_a_list_of_URLs
-----------------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mUrl Delete All (0.1ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "efdcfc"], ["created_at", "2023-06-11 16:48:45.261375"], ["updated_at", "2023-06-11 16:48:45.261375"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.org"], ["short_code", "c727a8"], ["created_at", "2023-06-11 16:48:45.263178"], ["updated_at", "2023-06-11 16:48:45.263178"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/urls" for 127.0.0.1 at 2023-06-11 22:18:45 +0530
Processing by UrlsController#index as HTML
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls"[0m
Completed 200 OK in 2ms (Views: 0.9ms | ActiveRecord: 0.2ms | Allocations: 742)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------
UrlsControllerTest: test_should_handle_URL_not_found
----------------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
Started GET "/invalid_short_code" for 127.0.0.1 at 2023-06-11 22:18:45 +0530
Processing by UrlsController#redirect as HTML
  Parameters: {"short_code"=>"invalid_short_code"}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "invalid_short_code"], ["LIMIT", 1]]
  Rendering text template
  Rendered text template (Duration: 0.0ms | Allocations: 8)
Completed 404 Not Found in 5ms (Views: 3.3ms | ActiveRecord: 0.3ms | Allocations: 2443)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------
UrlsControllerTest: test_should_redirect_to_the_original_URL
------------------------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "00f33a"], ["created_at", "2023-06-11 16:48:45.279602"], ["updated_at", "2023-06-11 16:48:45.279602"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/00f33a" for 127.0.0.1 at 2023-06-11 22:18:45 +0530
Processing by UrlsController#redirect as HTML
  Parameters: {"short_code"=>"00f33a"}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "00f33a"], ["LIMIT", 1]]
Redirected to https://example.com
Completed 302 Found in 1ms (ActiveRecord: 0.2ms | Allocations: 309)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.3ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "urls" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.6ms)[0m  [1m[31mDELETE FROM "urls";
INSERT INTO "urls" ("id", "original_url", "short_code", "created_at", "updated_at") VALUES (980190962, 'MyString', 'MyString', '2023-06-11 16:50:29.778019', '2023-06-11 16:50:29.778019'), (298486374, 'MyString', 'MyString', '2023-06-11 16:50:29.778019', '2023-06-11 16:50:29.778019')[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mALTER TABLE "urls" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (4.6ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------
UrlTest: test_should_have_a_unique_short_code
---------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.3ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", nil], ["created_at", "2023-06-11 16:50:29.808124"], ["updated_at", "2023-06-11 16:50:29.808124"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------
UrlTest: test_should_save_a_valid_URL
-------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", nil], ["created_at", "2023-06-11 16:50:29.814322"], ["updated_at", "2023-06-11 16:50:29.814322"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------
UrlTest: test_should_not_save_an_invalid_URL
--------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------
UrlsControllerTest: test_should_handle_URL_not_found
----------------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
Started GET "/invalid_short_code" for 127.0.0.1 at 2023-06-11 22:20:29 +0530
Processing by UrlsController#redirect as HTML
  Parameters: {"short_code"=>"invalid_short_code"}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "invalid_short_code"], ["LIMIT", 1]]
  Rendering text template
  Rendered text template (Duration: 0.0ms | Allocations: 8)
Completed 404 Not Found in 11ms (Views: 4.2ms | ActiveRecord: 0.4ms | Allocations: 5627)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------
UrlsControllerTest: test_should_create_a_new_URL
------------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
Started POST "/urls" for 127.0.0.1 at 2023-06-11 22:20:30 +0530
Processing by UrlsController#create as HTML
  Parameters: {"url"=>{"original_url"=>"https://example.com"}}
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "242ff1"], ["created_at", "2023-06-11 16:50:30.043761"], ["updated_at", "2023-06-11 16:50:30.043761"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 3ms (Views: 0.2ms | ActiveRecord: 0.7ms | Allocations: 1161)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------
UrlsControllerTest: test_should_return_a_list_of_URLs
-----------------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "3a5c56"], ["created_at", "2023-06-11 16:50:30.048471"], ["updated_at", "2023-06-11 16:50:30.048471"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.org"], ["short_code", "b4fa35"], ["created_at", "2023-06-11 16:50:30.050322"], ["updated_at", "2023-06-11 16:50:30.050322"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/urls" for 127.0.0.1 at 2023-06-11 22:20:30 +0530
Processing by UrlsController#index as HTML
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls"[0m
Completed 200 OK in 2ms (Views: 0.9ms | ActiveRecord: 0.2ms | Allocations: 560)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
UrlsControllerTest: test_should_handle_invalid_URL_creation
-----------------------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
Started POST "/urls" for 127.0.0.1 at 2023-06-11 22:20:30 +0530
Processing by UrlsController#create as HTML
  Parameters: {"url"=>{"original_url"=>""}}
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", ""], ["short_code", "f12379"], ["created_at", "2023-06-11 16:50:30.057810"], ["updated_at", "2023-06-11 16:50:30.057810"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 3ms (Views: 0.1ms | ActiveRecord: 0.6ms | Allocations: 756)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------
UrlsControllerTest: test_should_redirect_to_the_original_URL
------------------------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "01988d"], ["created_at", "2023-06-11 16:50:30.061661"], ["updated_at", "2023-06-11 16:50:30.061661"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/01988d" for 127.0.0.1 at 2023-06-11 22:20:30 +0530
Processing by UrlsController#redirect as HTML
  Parameters: {"short_code"=>"01988d"}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "01988d"], ["LIMIT", 1]]
Redirected to https://example.com
Completed 302 Found in 1ms (ActiveRecord: 0.2ms | Allocations: 294)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.3ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mALTER TABLE "urls" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.6ms)[0m  [1m[31mDELETE FROM "urls";
INSERT INTO "urls" ("id", "original_url", "short_code", "created_at", "updated_at") VALUES (980190962, 'MyString', 'MyString', '2023-06-11 16:52:28.142102', '2023-06-11 16:52:28.142102'), (298486374, 'MyString', 'MyString', '2023-06-11 16:52:28.142102', '2023-06-11 16:52:28.142102')[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mALTER TABLE "urls" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (5.7ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------
UrlTest: test_should_not_save_an_invalid_URL
--------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mUrl Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------
UrlTest: test_should_save_a_valid_URL
-------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", nil], ["created_at", "2023-06-11 16:52:28.177551"], ["updated_at", "2023-06-11 16:52:28.177551"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------
UrlTest: test_should_have_a_unique_short_code
---------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", nil], ["created_at", "2023-06-11 16:52:28.181492"], ["updated_at", "2023-06-11 16:52:28.181492"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------
UrlsControllerTest: test_should_handle_URL_not_found
----------------------------------------------------
  [1m[36mUrl Delete All (0.3ms)[0m  [1m[31mDELETE FROM "urls"[0m
Started GET "/invalid_short_code" for 127.0.0.1 at 2023-06-11 22:22:28 +0530
Processing by UrlsController#redirect as HTML
  Parameters: {"short_code"=>"invalid_short_code"}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "invalid_short_code"], ["LIMIT", 1]]
  Rendering text template
  Rendered text template (Duration: 0.0ms | Allocations: 8)
Completed 404 Not Found in 11ms (Views: 4.3ms | ActiveRecord: 0.4ms | Allocations: 5627)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
UrlsControllerTest: test_should_handle_invalid_URL_creation
-----------------------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
Started POST "/urls" for 127.0.0.1 at 2023-06-11 22:22:28 +0530
Processing by UrlsController#create as HTML
Completed 400 Bad Request in 1ms (ActiveRecord: 0.0ms | Allocations: 305)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------
UrlsControllerTest: test_should_redirect_to_the_original_URL
------------------------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "7776ba"], ["created_at", "2023-06-11 16:52:28.423553"], ["updated_at", "2023-06-11 16:52:28.423553"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/7776ba" for 127.0.0.1 at 2023-06-11 22:22:28 +0530
Processing by UrlsController#redirect as HTML
  Parameters: {"short_code"=>"7776ba"}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "7776ba"], ["LIMIT", 1]]
Redirected to https://example.com
Completed 302 Found in 1ms (ActiveRecord: 0.2ms | Allocations: 328)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------
UrlsControllerTest: test_should_create_a_new_URL
------------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
Started POST "/urls" for 127.0.0.1 at 2023-06-11 22:22:28 +0530
Processing by UrlsController#create as HTML
  Parameters: {"url"=>{"original_url"=>"https://example.com"}}
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "57e815"], ["created_at", "2023-06-11 16:52:28.431375"], ["updated_at", "2023-06-11 16:52:28.431375"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 3ms (Views: 0.2ms | ActiveRecord: 0.6ms | Allocations: 915)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------
UrlsControllerTest: test_should_return_a_list_of_URLs
-----------------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "eb8e34"], ["created_at", "2023-06-11 16:52:28.435600"], ["updated_at", "2023-06-11 16:52:28.435600"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.org"], ["short_code", "c52536"], ["created_at", "2023-06-11 16:52:28.437594"], ["updated_at", "2023-06-11 16:52:28.437594"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/urls" for 127.0.0.1 at 2023-06-11 22:22:28 +0530
Processing by UrlsController#index as HTML
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls"[0m
Completed 200 OK in 1ms (Views: 0.7ms | ActiveRecord: 0.2ms | Allocations: 528)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.3ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.3ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "urls" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.6ms)[0m  [1m[31mDELETE FROM "urls";
INSERT INTO "urls" ("id", "original_url", "short_code", "created_at", "updated_at") VALUES (980190962, 'MyString', 'MyString', '2023-06-11 16:53:11.503841', '2023-06-11 16:53:11.503841'), (298486374, 'MyString', 'MyString', '2023-06-11 16:53:11.503841', '2023-06-11 16:53:11.503841')[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mALTER TABLE "urls" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (5.7ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
UrlsControllerTest: test_should_handle_invalid_URL_creation
-----------------------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
Started POST "/urls" for 127.0.0.1 at 2023-06-11 22:23:11 +0530
Processing by UrlsController#create as HTML
  Parameters: {"url"=>{"original_url"=>""}}
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.3ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", ""], ["short_code", "2a0a74"], ["created_at", "2023-06-11 16:53:11.742781"], ["updated_at", "2023-06-11 16:53:11.742781"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 20ms (Views: 0.3ms | ActiveRecord: 0.8ms | Allocations: 20051)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------
UrlsControllerTest: test_should_handle_URL_not_found
----------------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
Started GET "/invalid_short_code" for 127.0.0.1 at 2023-06-11 22:23:11 +0530
Processing by UrlsController#redirect as HTML
  Parameters: {"short_code"=>"invalid_short_code"}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "invalid_short_code"], ["LIMIT", 1]]
  Rendering text template
  Rendered text template (Duration: 0.0ms | Allocations: 8)
Completed 404 Not Found in 6ms (Views: 4.2ms | ActiveRecord: 0.4ms | Allocations: 2572)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------
UrlsControllerTest: test_should_return_a_list_of_URLs
-----------------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "0c01d0"], ["created_at", "2023-06-11 16:53:11.763936"], ["updated_at", "2023-06-11 16:53:11.763936"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.org"], ["short_code", "00cb54"], ["created_at", "2023-06-11 16:53:11.766042"], ["updated_at", "2023-06-11 16:53:11.766042"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/urls" for 127.0.0.1 at 2023-06-11 22:23:11 +0530
Processing by UrlsController#index as HTML
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls"[0m
Completed 200 OK in 1ms (Views: 0.8ms | ActiveRecord: 0.2ms | Allocations: 603)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------
UrlsControllerTest: test_should_create_a_new_URL
------------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
Started POST "/urls" for 127.0.0.1 at 2023-06-11 22:23:11 +0530
Processing by UrlsController#create as HTML
  Parameters: {"url"=>{"original_url"=>"https://example.com"}}
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "3ab395"], ["created_at", "2023-06-11 16:53:11.773859"], ["updated_at", "2023-06-11 16:53:11.773859"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 3ms (Views: 0.1ms | ActiveRecord: 0.6ms | Allocations: 778)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------
UrlsControllerTest: test_should_redirect_to_the_original_URL
------------------------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "826bf3"], ["created_at", "2023-06-11 16:53:11.777695"], ["updated_at", "2023-06-11 16:53:11.777695"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/826bf3" for 127.0.0.1 at 2023-06-11 22:23:11 +0530
Processing by UrlsController#redirect as HTML
  Parameters: {"short_code"=>"826bf3"}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "826bf3"], ["LIMIT", 1]]
Redirected to https://example.com
Completed 302 Found in 1ms (ActiveRecord: 0.2ms | Allocations: 294)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------
UrlTest: test_should_save_a_valid_URL
-------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "6d34a0"], ["created_at", "2023-06-11 16:53:11.783900"], ["updated_at", "2023-06-11 16:53:11.783900"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------
UrlTest: test_should_have_a_unique_short_code
---------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "b78526"], ["created_at", "2023-06-11 16:53:11.787338"], ["updated_at", "2023-06-11 16:53:11.787338"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "b78526"], ["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "b78526"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------
UrlTest: test_should_not_save_an_invalid_URL
--------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.3ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "urls" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.5ms)[0m  [1m[31mDELETE FROM "urls";
INSERT INTO "urls" ("id", "original_url", "short_code", "created_at", "updated_at") VALUES (980190962, 'MyString', 'MyString', '2023-06-11 16:53:56.837005', '2023-06-11 16:53:56.837005'), (298486374, 'MyString', 'MyString', '2023-06-11 16:53:56.837005', '2023-06-11 16:53:56.837005')[0m
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mALTER TABLE "urls" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.9ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------
UrlTest: test_should_have_a_unique_short_code
---------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", nil], ["created_at", "2023-06-11 16:53:56.863719"], ["updated_at", "2023-06-11 16:53:56.863719"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------
UrlTest: test_should_not_save_an_invalid_URL
--------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-------------------------------------
UrlTest: test_should_save_a_valid_URL
-------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", nil], ["created_at", "2023-06-11 16:53:56.873022"], ["updated_at", "2023-06-11 16:53:56.873022"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
UrlsControllerTest: test_should_handle_invalid_URL_creation
-----------------------------------------------------------
  [1m[36mUrl Delete All (0.3ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------
UrlsControllerTest: test_should_create_a_new_URL
------------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
Started POST "/urls" for 127.0.0.1 at 2023-06-11 22:23:56 +0530
Processing by UrlsController#create as HTML
  Parameters: {"url"=>{"original_url"=>"https://example.com"}}
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "c64545"], ["created_at", "2023-06-11 16:53:57.067764"], ["updated_at", "2023-06-11 16:53:57.067764"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 8ms (Views: 0.3ms | ActiveRecord: 0.8ms | Allocations: 4217)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------
UrlsControllerTest: test_should_return_a_list_of_URLs
-----------------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "51619f"], ["created_at", "2023-06-11 16:53:57.074171"], ["updated_at", "2023-06-11 16:53:57.074171"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.org"], ["short_code", "fa751b"], ["created_at", "2023-06-11 16:53:57.076102"], ["updated_at", "2023-06-11 16:53:57.076102"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/urls" for 127.0.0.1 at 2023-06-11 22:23:57 +0530
Processing by UrlsController#index as HTML
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls"[0m
Completed 200 OK in 2ms (Views: 0.9ms | ActiveRecord: 0.2ms | Allocations: 742)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------
UrlsControllerTest: test_should_redirect_to_the_original_URL
------------------------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "1c2555"], ["created_at", "2023-06-11 16:53:57.085074"], ["updated_at", "2023-06-11 16:53:57.085074"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/1c2555" for 127.0.0.1 at 2023-06-11 22:23:57 +0530
Processing by UrlsController#redirect as HTML
  Parameters: {"short_code"=>"1c2555"}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "1c2555"], ["LIMIT", 1]]
Redirected to https://example.com
Completed 302 Found in 2ms (ActiveRecord: 0.3ms | Allocations: 491)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------
UrlsControllerTest: test_should_handle_URL_not_found
----------------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
Started GET "/invalid_short_code" for 127.0.0.1 at 2023-06-11 22:23:57 +0530
Processing by UrlsController#redirect as HTML
  Parameters: {"short_code"=>"invalid_short_code"}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "invalid_short_code"], ["LIMIT", 1]]
  Rendering text template
  Rendered text template (Duration: 0.0ms | Allocations: 8)
Completed 404 Not Found in 4ms (Views: 3.5ms | ActiveRecord: 0.2ms | Allocations: 2189)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.3ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "urls" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.5ms)[0m  [1m[31mDELETE FROM "urls";
INSERT INTO "urls" ("id", "original_url", "short_code", "created_at", "updated_at") VALUES (980190962, 'MyString', 'MyString', '2023-06-11 16:54:17.949144', '2023-06-11 16:54:17.949144'), (298486374, 'MyString', 'MyString', '2023-06-11 16:54:17.949144', '2023-06-11 16:54:17.949144')[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "urls" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.8ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------
UrlsControllerTest: test_should_create_a_new_URL
------------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
Started POST "/urls" for 127.0.0.1 at 2023-06-11 22:24:18 +0530
Processing by UrlsController#create as HTML
  Parameters: {"url"=>{"original_url"=>"https://example.com"}}
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "4d867d"], ["created_at", "2023-06-11 16:54:18.156269"], ["updated_at", "2023-06-11 16:54:18.156269"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 17ms (Views: 0.3ms | ActiveRecord: 0.8ms | Allocations: 20067)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------
UrlsControllerTest: test_should_redirect_to_the_original_URL
------------------------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "462f03"], ["created_at", "2023-06-11 16:54:18.162548"], ["updated_at", "2023-06-11 16:54:18.162548"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/462f03" for 127.0.0.1 at 2023-06-11 22:24:18 +0530
Processing by UrlsController#redirect as HTML
  Parameters: {"short_code"=>"462f03"}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "462f03"], ["LIMIT", 1]]
Redirected to https://example.com
Completed 302 Found in 2ms (ActiveRecord: 0.3ms | Allocations: 687)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------
UrlsControllerTest: test_should_return_a_list_of_URLs
-----------------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "981cb7"], ["created_at", "2023-06-11 16:54:18.172091"], ["updated_at", "2023-06-11 16:54:18.172091"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.org"], ["short_code", "98d69c"], ["created_at", "2023-06-11 16:54:18.174010"], ["updated_at", "2023-06-11 16:54:18.174010"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/urls" for 127.0.0.1 at 2023-06-11 22:24:18 +0530
Processing by UrlsController#index as HTML
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls"[0m
Completed 200 OK in 2ms (Views: 0.9ms | ActiveRecord: 0.2ms | Allocations: 567)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------
UrlsControllerTest: test_should_handle_URL_not_found
----------------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
Started GET "/invalid_short_code" for 127.0.0.1 at 2023-06-11 22:24:18 +0530
Processing by UrlsController#redirect as HTML
  Parameters: {"short_code"=>"invalid_short_code"}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "invalid_short_code"], ["LIMIT", 1]]
  Rendering text template
  Rendered text template (Duration: 0.0ms | Allocations: 8)
Completed 404 Not Found in 4ms (Views: 3.3ms | ActiveRecord: 0.2ms | Allocations: 2189)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
UrlsControllerTest: test_should_handle_invalid_URL_creation
-----------------------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
Started POST "/urls" for 127.0.0.1 at 2023-06-11 22:24:18 +0530
Processing by UrlsController#create as HTML
  Parameters: {"url"=>{"original_url"=>""}}
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", ""], ["short_code", "80eb32"], ["created_at", "2023-06-11 16:54:18.188709"], ["updated_at", "2023-06-11 16:54:18.188709"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 3ms (Views: 0.2ms | ActiveRecord: 0.6ms | Allocations: 938)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------
UrlTest: test_should_not_save_an_invalid_URL
--------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------
UrlTest: test_should_have_a_unique_short_code
---------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "ad57a8"], ["created_at", "2023-06-11 16:54:18.195392"], ["updated_at", "2023-06-11 16:54:18.195392"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "ad57a8"], ["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "ad57a8"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------
UrlTest: test_should_save_a_valid_URL
-------------------------------------
  [1m[36mUrl Delete All (0.3ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "c474b0"], ["created_at", "2023-06-11 16:54:18.200918"], ["updated_at", "2023-06-11 16:54:18.200918"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.4ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "urls" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.6ms)[0m  [1m[31mDELETE FROM "urls";
INSERT INTO "urls" ("id", "original_url", "short_code", "created_at", "updated_at") VALUES (980190962, 'MyString', 'MyString', '2023-06-11 16:58:24.822135', '2023-06-11 16:58:24.822135'), (298486374, 'MyString', 'MyString', '2023-06-11 16:58:24.822135', '2023-06-11 16:58:24.822135')[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mALTER TABLE "urls" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (5.5ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------
UrlsControllerTest: test_should_create_a_new_URL
------------------------------------------------
  [1m[36mUrl Delete All (0.3ms)[0m  [1m[31mDELETE FROM "urls"[0m
Started POST "/urls" for 127.0.0.1 at 2023-06-11 22:28:24 +0530
Processing by UrlsController#create as HTML
  Parameters: {"url"=>{"original_url"=>"https://example.com"}}
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.6ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "4fdf60"], ["created_at", "2023-06-11 16:58:39.143901"], ["updated_at", "2023-06-11 16:58:39.143901"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 26366ms (Views: 1.0ms | ActiveRecord: 2.3ms | Allocations: 672058)
  [1m[36mActiveRecord::InternalMetadata Pluck (0.3ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "urls" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.5ms)[0m  [1m[31mDELETE FROM "urls";
INSERT INTO "urls" ("id", "original_url", "short_code", "created_at", "updated_at") VALUES (980190962, 'MyString', 'MyString', '2023-06-11 16:59:20.520380', '2023-06-11 16:59:20.520380'), (298486374, 'MyString', 'MyString', '2023-06-11 16:59:20.520380', '2023-06-11 16:59:20.520380')[0m
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mALTER TABLE "urls" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (3.0ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------
UrlTest: test_should_not_save_an_invalid_URL
--------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mUrl Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------
UrlTest: test_should_have_a_unique_short_code
---------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", nil], ["created_at", "2023-06-11 16:59:20.549975"], ["updated_at", "2023-06-11 16:59:20.549975"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-------------------------------------
UrlTest: test_should_save_a_valid_URL
-------------------------------------
  [1m[36mUrl Delete All (0.3ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mUrl Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", nil], ["created_at", "2023-06-11 16:59:20.556023"], ["updated_at", "2023-06-11 16:59:20.556023"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
UrlsControllerTest: test_should_handle_invalid_URL_creation
-----------------------------------------------------------
  [1m[36mUrl Delete All (0.3ms)[0m  [1m[31mDELETE FROM "urls"[0m
Started POST "/urls" for 127.0.0.1 at 2023-06-11 22:29:20 +0530
Processing by UrlsController#create as HTML
  Parameters: {"url"=>{"original_url"=>""}}
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.4ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", ""], ["short_code", "2d10eb"], ["created_at", "2023-06-11 16:59:30.434419"], ["updated_at", "2023-06-11 16:59:30.434419"]]
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 500 Internal Server Error in 13705ms (ActiveRecord: 1.8ms | Allocations: 163329)
  [1m[36mActiveRecord::InternalMetadata Pluck (0.3ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "urls" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.6ms)[0m  [1m[31mDELETE FROM "urls";
INSERT INTO "urls" ("id", "original_url", "short_code", "created_at", "updated_at") VALUES (980190962, 'MyString', 'MyString', '2023-06-11 16:59:38.743437', '2023-06-11 16:59:38.743437'), (298486374, 'MyString', 'MyString', '2023-06-11 16:59:38.743437', '2023-06-11 16:59:38.743437')[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mALTER TABLE "urls" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (3.0ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------
UrlTest: test_should_not_save_an_invalid_URL
--------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mUrl Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------
UrlTest: test_should_have_a_unique_short_code
---------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.3ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", nil], ["created_at", "2023-06-11 16:59:38.774574"], ["updated_at", "2023-06-11 16:59:38.774574"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------
UrlTest: test_should_save_a_valid_URL
-------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", nil], ["created_at", "2023-06-11 16:59:38.780519"], ["updated_at", "2023-06-11 16:59:38.780519"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
UrlsControllerTest: test_should_handle_invalid_URL_creation
-----------------------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
Started POST "/urls" for 127.0.0.1 at 2023-06-11 22:29:38 +0530
Processing by UrlsController#create as HTML
  Parameters: {"url"=>{"original_url"=>""}}
Completed 500 Internal Server Error in 38001ms (ActiveRecord: 0.0ms | Allocations: 119129)
  [1m[36mActiveRecord::InternalMetadata Pluck (0.3ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "urls" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.5ms)[0m  [1m[31mDELETE FROM "urls";
INSERT INTO "urls" ("id", "original_url", "short_code", "created_at", "updated_at") VALUES (980190962, 'MyString', 'MyString', '2023-06-11 17:01:35.147047', '2023-06-11 17:01:35.147047'), (298486374, 'MyString', 'MyString', '2023-06-11 17:01:35.147047', '2023-06-11 17:01:35.147047')[0m
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mALTER TABLE "urls" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (3.0ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------
UrlsControllerTest: test_should_return_a_list_of_URLs
-----------------------------------------------------
  [1m[36mUrl Delete All (0.3ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mUrl Delete All (0.1ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", nil], ["created_at", "2023-06-11 17:01:35.266893"], ["updated_at", "2023-06-11 17:01:35.266893"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
Started GET "/urls" for 127.0.0.1 at 2023-06-11 22:31:35 +0530
Processing by UrlsController#index as HTML
  [1m[36mUrl Load (0.3ms)[0m  [1m[34mSELECT "urls".* FROM "urls"[0m
Completed 200 OK in 7ms (Views: 2.3ms | ActiveRecord: 0.3ms | Allocations: 3717)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------
UrlsControllerTest: test_should_redirect_to_the_original_URL
------------------------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "20eed2"], ["created_at", "2023-06-11 17:01:35.364562"], ["updated_at", "2023-06-11 17:01:35.364562"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/20eed2" for 127.0.0.1 at 2023-06-11 22:31:35 +0530
Processing by UrlsController#redirect as HTML
  Parameters: {"short_code"=>"20eed2"}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "20eed2"], ["LIMIT", 1]]
Redirected to https://example.com
Completed 302 Found in 2ms (ActiveRecord: 0.3ms | Allocations: 518)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
UrlsControllerTest: test_should_handle_invalid_URL_creation
-----------------------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
Started POST "/urls" for 127.0.0.1 at 2023-06-11 22:31:35 +0530
Processing by UrlsController#create as HTML
  Parameters: {"url"=>{"original_url"=>""}}
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", ""], ["short_code", "24cc41"], ["created_at", "2023-06-11 17:01:35.377993"], ["updated_at", "2023-06-11 17:01:35.377993"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 3ms (Views: 0.2ms | ActiveRecord: 0.6ms | Allocations: 1098)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------
UrlsControllerTest: test_should_create_a_new_URL
------------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
Started POST "/urls" for 127.0.0.1 at 2023-06-11 22:31:35 +0530
Processing by UrlsController#create as HTML
  Parameters: {"url"=>{"original_url"=>"https://example.com"}}
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.3ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "997795"], ["created_at", "2023-06-11 17:01:35.383749"], ["updated_at", "2023-06-11 17:01:35.383749"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 3ms (Views: 0.1ms | ActiveRecord: 0.7ms | Allocations: 761)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------
UrlsControllerTest: test_should_handle_URL_not_found
----------------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
Started GET "/invalid_short_code" for 127.0.0.1 at 2023-06-11 22:31:35 +0530
Processing by UrlsController#redirect as HTML
  Parameters: {"short_code"=>"invalid_short_code"}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "invalid_short_code"], ["LIMIT", 1]]
  Rendering text template
  Rendered text template (Duration: 0.0ms | Allocations: 8)
Completed 404 Not Found in 6ms (Views: 4.7ms | ActiveRecord: 0.2ms | Allocations: 2206)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------
UrlTest: test_should_save_a_valid_URL
-------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "b7fca8"], ["created_at", "2023-06-11 17:01:35.397045"], ["updated_at", "2023-06-11 17:01:35.397045"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------
UrlTest: test_should_have_a_unique_short_code
---------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.4ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "ffdfbc"], ["created_at", "2023-06-11 17:01:35.400700"], ["updated_at", "2023-06-11 17:01:35.400700"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "ffdfbc"], ["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "ffdfbc"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------
UrlTest: test_should_not_save_an_invalid_URL
--------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.3ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "urls" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.5ms)[0m  [1m[31mDELETE FROM "urls";
INSERT INTO "urls" ("id", "original_url", "short_code", "created_at", "updated_at") VALUES (980190962, 'MyString', 'MyString', '2023-06-11 17:06:32.245118', '2023-06-11 17:06:32.245118'), (298486374, 'MyString', 'MyString', '2023-06-11 17:06:32.245118', '2023-06-11 17:06:32.245118')[0m
  [1m[36mTRANSACTION (1.7ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mALTER TABLE "urls" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (4.8ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------
UrlTest: test_should_have_a_unique_short_code
---------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.3ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", nil], ["created_at", "2023-06-11 17:06:32.277927"], ["updated_at", "2023-06-11 17:06:32.277927"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------
UrlTest: test_should_save_a_valid_URL
-------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", nil], ["created_at", "2023-06-11 17:06:32.284974"], ["updated_at", "2023-06-11 17:06:32.284974"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------
UrlTest: test_should_not_save_an_invalid_URL
--------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
UrlsControllerTest: test_should_handle_invalid_URL_creation
-----------------------------------------------------------
  [1m[36mUrl Delete All (0.3ms)[0m  [1m[31mDELETE FROM "urls"[0m
Started POST "/urls" for 127.0.0.1 at 2023-06-11 22:36:32 +0530
Processing by UrlsController#create as HTML
  Parameters: {"url"=>{"original_url"=>"123"}}
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
Completed 422 Unprocessable Entity in 17ms (Views: 0.3ms | ActiveRecord: 0.6ms | Allocations: 7217)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------
UrlsControllerTest: test_should_return_a_list_of_URLs
-----------------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "fa129b"], ["created_at", "2023-06-11 17:06:32.520032"], ["updated_at", "2023-06-11 17:06:32.520032"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.org"], ["short_code", "a7a800"], ["created_at", "2023-06-11 17:06:32.522203"], ["updated_at", "2023-06-11 17:06:32.522203"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/urls" for 127.0.0.1 at 2023-06-11 22:36:32 +0530
Processing by UrlsController#index as HTML
  [1m[36mUrl Load (0.3ms)[0m  [1m[34mSELECT "urls".* FROM "urls"[0m
Completed 200 OK in 2ms (Views: 1.3ms | ActiveRecord: 0.3ms | Allocations: 742)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------
UrlsControllerTest: test_should_create_a_new_URL
------------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
Started POST "/urls" for 127.0.0.1 at 2023-06-11 22:36:32 +0530
Processing by UrlsController#create as HTML
  Parameters: {"url"=>{"original_url"=>"https://example.com"}}
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "3434f4"], ["created_at", "2023-06-11 17:06:32.534912"], ["updated_at", "2023-06-11 17:06:32.534912"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 3ms (Views: 0.2ms | ActiveRecord: 0.7ms | Allocations: 902)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------
UrlsControllerTest: test_should_redirect_to_the_original_URL
------------------------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "a29586"], ["created_at", "2023-06-11 17:06:32.539174"], ["updated_at", "2023-06-11 17:06:32.539174"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/a29586" for 127.0.0.1 at 2023-06-11 22:36:32 +0530
Processing by UrlsController#redirect as HTML
  Parameters: {"short_code"=>"a29586"}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "a29586"], ["LIMIT", 1]]
Redirected to https://example.com
Completed 302 Found in 2ms (ActiveRecord: 0.4ms | Allocations: 488)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------
UrlsControllerTest: test_should_handle_URL_not_found
----------------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
Started GET "/invalid_short_code" for 127.0.0.1 at 2023-06-11 22:36:32 +0530
Processing by UrlsController#redirect as HTML
  Parameters: {"short_code"=>"invalid_short_code"}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "invalid_short_code"], ["LIMIT", 1]]
  Rendering text template
  Rendered text template (Duration: 0.0ms | Allocations: 8)
Completed 404 Not Found in 5ms (Views: 4.2ms | ActiveRecord: 0.2ms | Allocations: 2189)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.3ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "urls" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.5ms)[0m  [1m[31mDELETE FROM "urls";
INSERT INTO "urls" ("id", "original_url", "short_code", "created_at", "updated_at") VALUES (980190962, 'MyString', 'MyString', '2023-06-11 17:06:36.627707', '2023-06-11 17:06:36.627707'), (298486374, 'MyString', 'MyString', '2023-06-11 17:06:36.627707', '2023-06-11 17:06:36.627707')[0m
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mALTER TABLE "urls" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (3.0ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------
UrlsControllerTest: test_should_redirect_to_the_original_URL
------------------------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", nil], ["created_at", "2023-06-11 17:06:36.739030"], ["updated_at", "2023-06-11 17:06:36.739030"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/" for 127.0.0.1 at 2023-06-11 22:36:36 +0530
Processing by UrlsController#create as HTML
Completed 400 Bad Request in 4ms (ActiveRecord: 0.0ms | Allocations: 3256)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------
UrlsControllerTest: test_should_handle_URL_not_found
----------------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
Started GET "/invalid_short_code" for 127.0.0.1 at 2023-06-11 22:36:36 +0530
Processing by UrlsController#redirect as HTML
  Parameters: {"short_code"=>"invalid_short_code"}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "invalid_short_code"], ["LIMIT", 1]]
  Rendering text template
  Rendered text template (Duration: 0.0ms | Allocations: 8)
Completed 404 Not Found in 5ms (Views: 3.4ms | ActiveRecord: 0.3ms | Allocations: 2585)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------
UrlsControllerTest: test_should_return_a_list_of_URLs
-----------------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mUrl Delete All (0.1ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "9e4097"], ["created_at", "2023-06-11 17:06:36.835782"], ["updated_at", "2023-06-11 17:06:36.835782"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.org"], ["short_code", "c22799"], ["created_at", "2023-06-11 17:06:36.837857"], ["updated_at", "2023-06-11 17:06:36.837857"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/urls" for 127.0.0.1 at 2023-06-11 22:36:36 +0530
Processing by UrlsController#index as HTML
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls"[0m
Completed 200 OK in 1ms (Views: 0.8ms | ActiveRecord: 0.2ms | Allocations: 643)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
UrlsControllerTest: test_should_handle_invalid_URL_creation
-----------------------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
Started POST "/urls" for 127.0.0.1 at 2023-06-11 22:36:36 +0530
Processing by UrlsController#create as HTML
  Parameters: {"url"=>{"original_url"=>"123"}}
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
Completed 422 Unprocessable Entity in 4ms (Views: 0.2ms | ActiveRecord: 0.4ms | Allocations: 2549)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------
UrlsControllerTest: test_should_create_a_new_URL
------------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
Started POST "/urls" for 127.0.0.1 at 2023-06-11 22:36:36 +0530
Processing by UrlsController#create as HTML
  Parameters: {"url"=>{"original_url"=>"https://example.com"}}
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "fd4d85"], ["created_at", "2023-06-11 17:06:36.856481"], ["updated_at", "2023-06-11 17:06:36.856481"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 3ms (Views: 0.1ms | ActiveRecord: 0.6ms | Allocations: 850)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------
UrlTest: test_should_not_save_an_invalid_URL
--------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------
UrlTest: test_should_save_a_valid_URL
-------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mUrl Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "323379"], ["created_at", "2023-06-11 17:06:36.864363"], ["updated_at", "2023-06-11 17:06:36.864363"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------
UrlTest: test_should_have_a_unique_short_code
---------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "9e74be"], ["created_at", "2023-06-11 17:06:36.868015"], ["updated_at", "2023-06-11 17:06:36.868015"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "9e74be"], ["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "9e74be"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.3ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "urls" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.5ms)[0m  [1m[31mDELETE FROM "urls";
INSERT INTO "urls" ("id", "original_url", "short_code", "created_at", "updated_at") VALUES (980190962, 'MyString', 'MyString', '2023-06-11 17:07:37.622365', '2023-06-11 17:07:37.622365'), (298486374, 'MyString', 'MyString', '2023-06-11 17:07:37.622365', '2023-06-11 17:07:37.622365')[0m
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mALTER TABLE "urls" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (3.0ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
UrlsControllerTest: test_should_handle_invalid_URL_creation
-----------------------------------------------------------
  [1m[36mUrl Delete All (0.3ms)[0m  [1m[31mDELETE FROM "urls"[0m
Started POST "/urls" for 127.0.0.1 at 2023-06-11 22:37:37 +0530
Processing by UrlsController#create as HTML
  Parameters: {"url"=>{"original_url"=>"123"}}
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
Completed 422 Unprocessable Entity in 18ms (Views: 0.3ms | ActiveRecord: 0.5ms | Allocations: 21249)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------
UrlsControllerTest: test_should_handle_URL_not_found
----------------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
Started GET "/invalid_short_code" for 127.0.0.1 at 2023-06-11 22:37:37 +0530
Processing by UrlsController#redirect as HTML
  Parameters: {"short_code"=>"invalid_short_code"}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "invalid_short_code"], ["LIMIT", 1]]
  Rendering text template
  Rendered text template (Duration: 0.0ms | Allocations: 8)
Completed 404 Not Found in 5ms (Views: 3.2ms | ActiveRecord: 0.3ms | Allocations: 2591)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------
UrlsControllerTest: test_should_create_a_new_URL
------------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
Started POST "/urls" for 127.0.0.1 at 2023-06-11 22:37:37 +0530
Processing by UrlsController#create as HTML
  Parameters: {"url"=>{"original_url"=>"https://example.com"}}
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "43f987"], ["created_at", "2023-06-11 17:07:37.833632"], ["updated_at", "2023-06-11 17:07:37.833632"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 3ms (Views: 0.2ms | ActiveRecord: 0.7ms | Allocations: 1221)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------
UrlsControllerTest: test_should_redirect_to_the_original_URL
------------------------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "414c0c"], ["created_at", "2023-06-11 17:07:37.838115"], ["updated_at", "2023-06-11 17:07:37.838115"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/414c0c?url=https%3A%2F%2Fexample.com" for 127.0.0.1 at 2023-06-11 22:37:37 +0530
Processing by UrlsController#redirect as HTML
  Parameters: {"url"=>"https://example.com", "short_code"=>"414c0c"}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "414c0c"], ["LIMIT", 1]]
Redirected to https://example.com
Completed 302 Found in 1ms (ActiveRecord: 0.2ms | Allocations: 326)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------
UrlsControllerTest: test_should_return_a_list_of_URLs
-----------------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mUrl Delete All (0.1ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "2ef5a2"], ["created_at", "2023-06-11 17:07:37.844219"], ["updated_at", "2023-06-11 17:07:37.844219"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.org"], ["short_code", "269472"], ["created_at", "2023-06-11 17:07:37.845944"], ["updated_at", "2023-06-11 17:07:37.845944"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/urls" for 127.0.0.1 at 2023-06-11 22:37:37 +0530
Processing by UrlsController#index as HTML
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls"[0m
Completed 200 OK in 1ms (Views: 0.7ms | ActiveRecord: 0.2ms | Allocations: 527)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------
UrlTest: test_should_not_save_an_invalid_URL
--------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------
UrlTest: test_should_have_a_unique_short_code
---------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "78c829"], ["created_at", "2023-06-11 17:07:37.854283"], ["updated_at", "2023-06-11 17:07:37.854283"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "78c829"], ["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "78c829"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------
UrlTest: test_should_save_a_valid_URL
-------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "c429de"], ["created_at", "2023-06-11 17:07:37.858894"], ["updated_at", "2023-06-11 17:07:37.858894"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.3ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "urls" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.5ms)[0m  [1m[31mDELETE FROM "urls";
INSERT INTO "urls" ("id", "original_url", "short_code", "created_at", "updated_at") VALUES (980190962, 'MyString', 'MyString', '2023-06-11 17:07:41.909820', '2023-06-11 17:07:41.909820'), (298486374, 'MyString', 'MyString', '2023-06-11 17:07:41.909820', '2023-06-11 17:07:41.909820')[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "urls" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.9ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------
UrlsControllerTest: test_should_return_a_list_of_URLs
-----------------------------------------------------
  [1m[36mUrl Delete All (0.3ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", nil], ["created_at", "2023-06-11 17:07:42.030838"], ["updated_at", "2023-06-11 17:07:42.030838"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
Started GET "/urls" for 127.0.0.1 at 2023-06-11 22:37:42 +0530
Processing by UrlsController#index as HTML
  [1m[36mUrl Load (0.3ms)[0m  [1m[34mSELECT "urls".* FROM "urls"[0m
Completed 200 OK in 6ms (Views: 1.2ms | ActiveRecord: 0.3ms | Allocations: 3717)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------
UrlsControllerTest: test_should_redirect_to_the_original_URL
------------------------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "94011e"], ["created_at", "2023-06-11 17:07:42.124257"], ["updated_at", "2023-06-11 17:07:42.124257"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/94011e?url=https%3A%2F%2Fexample.com" for 127.0.0.1 at 2023-06-11 22:37:42 +0530
Processing by UrlsController#redirect as HTML
  Parameters: {"url"=>"https://example.com", "short_code"=>"94011e"}
  [1m[36mUrl Load (0.3ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "94011e"], ["LIMIT", 1]]
Redirected to https://example.com
Completed 302 Found in 2ms (ActiveRecord: 0.4ms | Allocations: 518)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------
UrlsControllerTest: test_should_handle_URL_not_found
----------------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
Started GET "/invalid_short_code" for 127.0.0.1 at 2023-06-11 22:37:42 +0530
Processing by UrlsController#redirect as HTML
  Parameters: {"short_code"=>"invalid_short_code"}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "invalid_short_code"], ["LIMIT", 1]]
  Rendering text template
  Rendered text template (Duration: 0.0ms | Allocations: 8)
Completed 404 Not Found in 4ms (Views: 3.4ms | ActiveRecord: 0.2ms | Allocations: 2202)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------
UrlsControllerTest: test_should_create_a_new_URL
------------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
Started POST "/urls" for 127.0.0.1 at 2023-06-11 22:37:42 +0530
Processing by UrlsController#create as HTML
  Parameters: {"url"=>{"original_url"=>"https://example.com"}}
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "ad64c7"], ["created_at", "2023-06-11 17:07:42.144016"], ["updated_at", "2023-06-11 17:07:42.144016"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 3ms (Views: 0.2ms | ActiveRecord: 0.6ms | Allocations: 1102)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
UrlsControllerTest: test_should_handle_invalid_URL_creation
-----------------------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
Started POST "/urls" for 127.0.0.1 at 2023-06-11 22:37:42 +0530
Processing by UrlsController#create as HTML
  Parameters: {"url"=>{"original_url"=>"123"}}
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
Completed 422 Unprocessable Entity in 4ms (Views: 0.1ms | ActiveRecord: 0.4ms | Allocations: 2265)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------
UrlTest: test_should_not_save_an_invalid_URL
--------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------
UrlTest: test_should_have_a_unique_short_code
---------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "048e7d"], ["created_at", "2023-06-11 17:07:42.158008"], ["updated_at", "2023-06-11 17:07:42.158008"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "048e7d"], ["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "048e7d"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------
UrlTest: test_should_save_a_valid_URL
-------------------------------------
  [1m[36mUrl Delete All (0.3ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "2145ad"], ["created_at", "2023-06-11 17:07:42.163323"], ["updated_at", "2023-06-11 17:07:42.163323"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.3ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "urls" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.5ms)[0m  [1m[31mDELETE FROM "urls";
INSERT INTO "urls" ("id", "original_url", "short_code", "created_at", "updated_at") VALUES (980190962, 'MyString', 'MyString', '2023-06-11 17:07:47.655674', '2023-06-11 17:07:47.655674'), (298486374, 'MyString', 'MyString', '2023-06-11 17:07:47.655674', '2023-06-11 17:07:47.655674')[0m
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mALTER TABLE "urls" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.9ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------
UrlsControllerTest: test_should_return_a_list_of_URLs
-----------------------------------------------------
  [1m[36mUrl Delete All (0.3ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mUrl Delete All (0.1ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", nil], ["created_at", "2023-06-11 17:07:47.775278"], ["updated_at", "2023-06-11 17:07:47.775278"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
Started GET "/urls" for 127.0.0.1 at 2023-06-11 22:37:47 +0530
Processing by UrlsController#index as HTML
  [1m[36mUrl Load (0.3ms)[0m  [1m[34mSELECT "urls".* FROM "urls"[0m
Completed 200 OK in 6ms (Views: 1.1ms | ActiveRecord: 0.3ms | Allocations: 3717)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------
UrlsControllerTest: test_should_redirect_to_the_original_URL
------------------------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "7e4a52"], ["created_at", "2023-06-11 17:07:47.869890"], ["updated_at", "2023-06-11 17:07:47.869890"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/7e4a52?url=https%3A%2F%2Fexample.com" for 127.0.0.1 at 2023-06-11 22:37:47 +0530
Processing by UrlsController#redirect as HTML
  Parameters: {"url"=>"https://example.com", "short_code"=>"7e4a52"}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "7e4a52"], ["LIMIT", 1]]
Redirected to https://example.com
Completed 302 Found in 2ms (ActiveRecord: 0.3ms | Allocations: 518)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------
UrlsControllerTest: test_should_create_a_new_URL
------------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
Started POST "/urls" for 127.0.0.1 at 2023-06-11 22:37:47 +0530
Processing by UrlsController#create as HTML
  Parameters: {"url"=>{"original_url"=>"https://example.com"}}
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "0ba68f"], ["created_at", "2023-06-11 17:07:47.883562"], ["updated_at", "2023-06-11 17:07:47.883562"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 3ms (Views: 0.2ms | ActiveRecord: 0.6ms | Allocations: 1103)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------
UrlsControllerTest: test_should_handle_URL_not_found
----------------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
Started GET "/invalid_short_code" for 127.0.0.1 at 2023-06-11 22:37:47 +0530
Processing by UrlsController#redirect as HTML
  Parameters: {"short_code"=>"invalid_short_code"}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "invalid_short_code"], ["LIMIT", 1]]
  Rendering text template
  Rendered text template (Duration: 0.0ms | Allocations: 8)
Completed 404 Not Found in 4ms (Views: 3.3ms | ActiveRecord: 0.2ms | Allocations: 2206)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
UrlsControllerTest: test_should_handle_invalid_URL_creation
-----------------------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
Started POST "/urls" for 127.0.0.1 at 2023-06-11 22:37:47 +0530
Processing by UrlsController#create as HTML
  Parameters: {"url"=>{"original_url"=>"123"}}
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
Completed 422 Unprocessable Entity in 4ms (Views: 0.2ms | ActiveRecord: 0.4ms | Allocations: 2389)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------
UrlTest: test_should_not_save_an_invalid_URL
--------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------
UrlTest: test_should_have_a_unique_short_code
---------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "644100"], ["created_at", "2023-06-11 17:07:47.904465"], ["updated_at", "2023-06-11 17:07:47.904465"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "644100"], ["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "644100"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------
UrlTest: test_should_save_a_valid_URL
-------------------------------------
  [1m[36mUrl Delete All (0.3ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "b758cf"], ["created_at", "2023-06-11 17:07:47.910291"], ["updated_at", "2023-06-11 17:07:47.910291"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.3ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mALTER TABLE "urls" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.6ms)[0m  [1m[31mDELETE FROM "urls";
INSERT INTO "urls" ("id", "original_url", "short_code", "created_at", "updated_at") VALUES (980190962, 'MyString', 'MyString', '2023-06-11 17:08:40.824458', '2023-06-11 17:08:40.824458'), (298486374, 'MyString', 'MyString', '2023-06-11 17:08:40.824458', '2023-06-11 17:08:40.824458')[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mALTER TABLE "urls" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (4.9ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------
UrlTest: test_should_save_a_valid_URL
-------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mUrl Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", nil], ["created_at", "2023-06-11 17:08:40.856396"], ["updated_at", "2023-06-11 17:08:40.856396"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------
UrlTest: test_should_not_save_an_invalid_URL
--------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------
UrlTest: test_should_have_a_unique_short_code
---------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", nil], ["created_at", "2023-06-11 17:08:40.863552"], ["updated_at", "2023-06-11 17:08:40.863552"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------
UrlsControllerTest: test_should_handle_URL_not_found
----------------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
Started GET "/invalid_short_code" for 127.0.0.1 at 2023-06-11 22:38:40 +0530
Processing by UrlsController#redirect as HTML
  Parameters: {"short_code"=>"invalid_short_code"}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "invalid_short_code"], ["LIMIT", 1]]
  Rendering text template
  Rendered text template (Duration: 0.0ms | Allocations: 8)
Completed 404 Not Found in 12ms (Views: 4.6ms | ActiveRecord: 0.4ms | Allocations: 5627)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
UrlsControllerTest: test_should_handle_invalid_URL_creation
-----------------------------------------------------------
  [1m[36mUrl Delete All (0.3ms)[0m  [1m[31mDELETE FROM "urls"[0m
Started POST "/urls" for 127.0.0.1 at 2023-06-11 22:38:41 +0530
Processing by UrlsController#create as HTML
  Parameters: {"url"=>{"original_url"=>"123"}}
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
Completed 422 Unprocessable Entity in 8ms (Views: 0.3ms | ActiveRecord: 0.5ms | Allocations: 2558)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------
UrlsControllerTest: test_should_create_a_new_URL
------------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
Started POST "/urls" for 127.0.0.1 at 2023-06-11 22:38:41 +0530
Processing by UrlsController#create as HTML
  Parameters: {"url"=>{"original_url"=>"https://example.com"}}
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "d5fa46"], ["created_at", "2023-06-11 17:08:41.104556"], ["updated_at", "2023-06-11 17:08:41.104556"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 3ms (Views: 0.1ms | ActiveRecord: 0.7ms | Allocations: 875)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------
UrlsControllerTest: test_should_redirect_to_the_original_URL
------------------------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "36f369"], ["created_at", "2023-06-11 17:08:41.109042"], ["updated_at", "2023-06-11 17:08:41.109042"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/36f369?url=https%3A%2F%2Fexample.com" for 127.0.0.1 at 2023-06-11 22:38:41 +0530
Processing by UrlsController#redirect as HTML
  Parameters: {"url"=>"https://example.com", "short_code"=>"36f369"}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "36f369"], ["LIMIT", 1]]
Redirected to https://example.com
Completed 302 Found in 1ms (ActiveRecord: 0.2ms | Allocations: 326)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------
UrlsControllerTest: test_should_return_a_list_of_URLs
-----------------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "6c39b1"], ["created_at", "2023-06-11 17:08:41.115880"], ["updated_at", "2023-06-11 17:08:41.115880"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.org"], ["short_code", "0c5c06"], ["created_at", "2023-06-11 17:08:41.117830"], ["updated_at", "2023-06-11 17:08:41.117830"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/urls" for 127.0.0.1 at 2023-06-11 22:38:41 +0530
Processing by UrlsController#index as HTML
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls"[0m
Completed 200 OK in 1ms (Views: 0.8ms | ActiveRecord: 0.2ms | Allocations: 526)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.4ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "urls" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.6ms)[0m  [1m[31mDELETE FROM "urls";
INSERT INTO "urls" ("id", "original_url", "short_code", "created_at", "updated_at") VALUES (980190962, 'MyString', 'MyString', '2023-06-11 17:08:44.955584', '2023-06-11 17:08:44.955584'), (298486374, 'MyString', 'MyString', '2023-06-11 17:08:44.955584', '2023-06-11 17:08:44.955584')[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mALTER TABLE "urls" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.9ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------
UrlsControllerTest: test_should_create_a_new_URL
------------------------------------------------
  [1m[36mUrl Delete All (0.3ms)[0m  [1m[31mDELETE FROM "urls"[0m
Started POST "/urls" for 127.0.0.1 at 2023-06-11 22:38:45 +0530
Processing by UrlsController#create as HTML
  Parameters: {"url"=>{"original_url"=>"https://example.com"}}
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "f183c8"], ["created_at", "2023-06-11 17:08:45.153250"], ["updated_at", "2023-06-11 17:08:45.153250"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 17ms (Views: 0.3ms | ActiveRecord: 0.8ms | Allocations: 20067)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------
UrlsControllerTest: test_should_redirect_to_the_original_URL
------------------------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "566d1d"], ["created_at", "2023-06-11 17:08:45.159535"], ["updated_at", "2023-06-11 17:08:45.159535"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/566d1d?url=https%3A%2F%2Fexample.com" for 127.0.0.1 at 2023-06-11 22:38:45 +0530
Processing by UrlsController#redirect as HTML
  Parameters: {"url"=>"https://example.com", "short_code"=>"566d1d"}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "566d1d"], ["LIMIT", 1]]
Redirected to https://example.com
Completed 302 Found in 2ms (ActiveRecord: 0.3ms | Allocations: 687)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
UrlsControllerTest: test_should_handle_invalid_URL_creation
-----------------------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
Started POST "/urls" for 127.0.0.1 at 2023-06-11 22:38:45 +0530
Processing by UrlsController#create as HTML
  Parameters: {"url"=>{"original_url"=>"123"}}
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
Completed 422 Unprocessable Entity in 4ms (Views: 0.2ms | ActiveRecord: 0.4ms | Allocations: 2365)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------
UrlsControllerTest: test_should_return_a_list_of_URLs
-----------------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mUrl Delete All (0.1ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "f1d723"], ["created_at", "2023-06-11 17:08:45.176549"], ["updated_at", "2023-06-11 17:08:45.176549"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.org"], ["short_code", "53c016"], ["created_at", "2023-06-11 17:08:45.178438"], ["updated_at", "2023-06-11 17:08:45.178438"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/urls" for 127.0.0.1 at 2023-06-11 22:38:45 +0530
Processing by UrlsController#index as HTML
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls"[0m
Completed 200 OK in 1ms (Views: 0.7ms | ActiveRecord: 0.2ms | Allocations: 526)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------
UrlsControllerTest: test_should_handle_URL_not_found
----------------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
Started GET "/invalid_short_code" for 127.0.0.1 at 2023-06-11 22:38:45 +0530
Processing by UrlsController#redirect as HTML
  Parameters: {"short_code"=>"invalid_short_code"}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "invalid_short_code"], ["LIMIT", 1]]
  Rendering text template
  Rendered text template (Duration: 0.0ms | Allocations: 8)
Completed 404 Not Found in 4ms (Views: 3.3ms | ActiveRecord: 0.2ms | Allocations: 2189)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------
UrlTest: test_should_have_a_unique_short_code
---------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "bcdf40"], ["created_at", "2023-06-11 17:08:45.191730"], ["updated_at", "2023-06-11 17:08:45.191730"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "bcdf40"], ["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "bcdf40"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------
UrlTest: test_should_save_a_valid_URL
-------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "557eb3"], ["created_at", "2023-06-11 17:08:45.196793"], ["updated_at", "2023-06-11 17:08:45.196793"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------
UrlTest: test_should_not_save_an_invalid_URL
--------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.3ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "urls" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.5ms)[0m  [1m[31mDELETE FROM "urls";
INSERT INTO "urls" ("id", "original_url", "short_code", "created_at", "updated_at") VALUES (980190962, 'MyString', 'MyString', '2023-06-11 17:08:48.502832', '2023-06-11 17:08:48.502832'), (298486374, 'MyString', 'MyString', '2023-06-11 17:08:48.502832', '2023-06-11 17:08:48.502832')[0m
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mALTER TABLE "urls" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.9ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------
UrlTest: test_should_have_a_unique_short_code
---------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", nil], ["created_at", "2023-06-11 17:08:48.529910"], ["updated_at", "2023-06-11 17:08:48.529910"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------
UrlTest: test_should_not_save_an_invalid_URL
--------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------
UrlTest: test_should_save_a_valid_URL
-------------------------------------
  [1m[36mUrl Delete All (0.3ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", nil], ["created_at", "2023-06-11 17:08:48.539053"], ["updated_at", "2023-06-11 17:08:48.539053"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------
UrlsControllerTest: test_should_create_a_new_URL
------------------------------------------------
  [1m[36mUrl Delete All (0.3ms)[0m  [1m[31mDELETE FROM "urls"[0m
Started POST "/urls" for 127.0.0.1 at 2023-06-11 22:38:48 +0530
Processing by UrlsController#create as HTML
  Parameters: {"url"=>{"original_url"=>"https://example.com"}}
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "7663a6"], ["created_at", "2023-06-11 17:08:48.721732"], ["updated_at", "2023-06-11 17:08:48.721732"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 7ms (Views: 0.3ms | ActiveRecord: 0.7ms | Allocations: 4218)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------
UrlsControllerTest: test_should_redirect_to_the_original_URL
------------------------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "617054"], ["created_at", "2023-06-11 17:08:48.727547"], ["updated_at", "2023-06-11 17:08:48.727547"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/617054?url=https%3A%2F%2Fexample.com" for 127.0.0.1 at 2023-06-11 22:38:48 +0530
Processing by UrlsController#redirect as HTML
  Parameters: {"url"=>"https://example.com", "short_code"=>"617054"}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "617054"], ["LIMIT", 1]]
Redirected to https://example.com
Completed 302 Found in 2ms (ActiveRecord: 0.4ms | Allocations: 687)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
UrlsControllerTest: test_should_handle_invalid_URL_creation
-----------------------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
Started POST "/urls" for 127.0.0.1 at 2023-06-11 22:38:48 +0530
Processing by UrlsController#create as HTML
  Parameters: {"url"=>{"original_url"=>"123"}}
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
Completed 422 Unprocessable Entity in 4ms (Views: 0.2ms | ActiveRecord: 0.4ms | Allocations: 2337)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------
UrlsControllerTest: test_should_return_a_list_of_URLs
-----------------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mUrl Delete All (0.1ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "fd5185"], ["created_at", "2023-06-11 17:08:48.744276"], ["updated_at", "2023-06-11 17:08:48.744276"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.org"], ["short_code", "c3a791"], ["created_at", "2023-06-11 17:08:48.746158"], ["updated_at", "2023-06-11 17:08:48.746158"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/urls" for 127.0.0.1 at 2023-06-11 22:38:48 +0530
Processing by UrlsController#index as HTML
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls"[0m
Completed 200 OK in 1ms (Views: 0.7ms | ActiveRecord: 0.2ms | Allocations: 526)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------
UrlsControllerTest: test_should_handle_URL_not_found
----------------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
Started GET "/invalid_short_code" for 127.0.0.1 at 2023-06-11 22:38:48 +0530
Processing by UrlsController#redirect as HTML
  Parameters: {"short_code"=>"invalid_short_code"}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "invalid_short_code"], ["LIMIT", 1]]
  Rendering text template
  Rendered text template (Duration: 0.0ms | Allocations: 8)
Completed 404 Not Found in 4ms (Views: 3.3ms | ActiveRecord: 0.2ms | Allocations: 2189)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.3ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "urls" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.5ms)[0m  [1m[31mDELETE FROM "urls";
INSERT INTO "urls" ("id", "original_url", "short_code", "created_at", "updated_at") VALUES (980190962, 'MyString', 'MyString', '2023-06-11 17:08:52.168766', '2023-06-11 17:08:52.168766'), (298486374, 'MyString', 'MyString', '2023-06-11 17:08:52.168766', '2023-06-11 17:08:52.168766')[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mALTER TABLE "urls" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (3.0ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------
UrlsControllerTest: test_should_redirect_to_the_original_URL
------------------------------------------------------------
  [1m[36mUrl Delete All (0.3ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.3ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", nil], ["created_at", "2023-06-11 17:08:52.293954"], ["updated_at", "2023-06-11 17:08:52.293954"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/?url=https%3A%2F%2Fexample.com" for 127.0.0.1 at 2023-06-11 22:38:52 +0530
Processing by UrlsController#create as HTML
  Parameters: {"url"=>"https://example.com"}
Completed 500 Internal Server Error in 6ms (ActiveRecord: 0.0ms | Allocations: 4371)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------
UrlsControllerTest: test_should_create_a_new_URL
------------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
Started POST "/urls" for 127.0.0.1 at 2023-06-11 22:38:52 +0530
Processing by UrlsController#create as HTML
  Parameters: {"url"=>{"original_url"=>"https://example.com"}}
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "1ecd7a"], ["created_at", "2023-06-11 17:08:52.394251"], ["updated_at", "2023-06-11 17:08:52.394251"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 4ms (Views: 0.3ms | ActiveRecord: 0.7ms | Allocations: 1246)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
UrlsControllerTest: test_should_handle_invalid_URL_creation
-----------------------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
Started POST "/urls" for 127.0.0.1 at 2023-06-11 22:38:52 +0530
Processing by UrlsController#create as HTML
  Parameters: {"url"=>{"original_url"=>"123"}}
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
Completed 422 Unprocessable Entity in 4ms (Views: 0.2ms | ActiveRecord: 0.4ms | Allocations: 2433)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------
UrlsControllerTest: test_should_return_a_list_of_URLs
-----------------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "27c4ca"], ["created_at", "2023-06-11 17:08:52.407963"], ["updated_at", "2023-06-11 17:08:52.407963"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.org"], ["short_code", "c3c30a"], ["created_at", "2023-06-11 17:08:52.410105"], ["updated_at", "2023-06-11 17:08:52.410105"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/urls" for 127.0.0.1 at 2023-06-11 22:38:52 +0530
Processing by UrlsController#index as HTML
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls"[0m
Completed 200 OK in 1ms (Views: 0.8ms | ActiveRecord: 0.2ms | Allocations: 595)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------
UrlsControllerTest: test_should_handle_URL_not_found
----------------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
Started GET "/invalid_short_code" for 127.0.0.1 at 2023-06-11 22:38:52 +0530
Processing by UrlsController#redirect as HTML
  Parameters: {"short_code"=>"invalid_short_code"}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "invalid_short_code"], ["LIMIT", 1]]
  Rendering text template
  Rendered text template (Duration: 0.0ms | Allocations: 8)
Completed 404 Not Found in 5ms (Views: 3.3ms | ActiveRecord: 0.3ms | Allocations: 2397)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------
UrlTest: test_should_have_a_unique_short_code
---------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.5ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "66f2c1"], ["created_at", "2023-06-11 17:08:52.424319"], ["updated_at", "2023-06-11 17:08:52.424319"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "66f2c1"], ["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "66f2c1"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------
UrlTest: test_should_save_a_valid_URL
-------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "8e4bcf"], ["created_at", "2023-06-11 17:08:52.430038"], ["updated_at", "2023-06-11 17:08:52.430038"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------
UrlTest: test_should_not_save_an_invalid_URL
--------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.3ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "urls" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.5ms)[0m  [1m[31mDELETE FROM "urls";
INSERT INTO "urls" ("id", "original_url", "short_code", "created_at", "updated_at") VALUES (980190962, 'MyString', 'MyString', '2023-06-11 17:08:57.531578', '2023-06-11 17:08:57.531578'), (298486374, 'MyString', 'MyString', '2023-06-11 17:08:57.531578', '2023-06-11 17:08:57.531578')[0m
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mALTER TABLE "urls" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.9ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------
UrlTest: test_should_save_a_valid_URL
-------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mUrl Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Create (0.3ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", nil], ["created_at", "2023-06-11 17:08:57.558158"], ["updated_at", "2023-06-11 17:08:57.558158"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------
UrlTest: test_should_have_a_unique_short_code
---------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.3ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", nil], ["created_at", "2023-06-11 17:08:57.562835"], ["updated_at", "2023-06-11 17:08:57.562835"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------
UrlTest: test_should_not_save_an_invalid_URL
--------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mCACHE Url Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------
UrlsControllerTest: test_should_create_a_new_URL
------------------------------------------------
  [1m[36mUrl Delete All (0.3ms)[0m  [1m[31mDELETE FROM "urls"[0m
Started POST "/urls" for 127.0.0.1 at 2023-06-11 22:38:57 +0530
Processing by UrlsController#create as HTML
  Parameters: {"url"=>{"original_url"=>"https://example.com"}}
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "03787b"], ["created_at", "2023-06-11 17:08:57.744658"], ["updated_at", "2023-06-11 17:08:57.744658"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 7ms (Views: 0.3ms | ActiveRecord: 0.7ms | Allocations: 4218)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------
UrlsControllerTest: test_should_redirect_to_the_original_URL
------------------------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "2c9fbd"], ["created_at", "2023-06-11 17:08:57.750515"], ["updated_at", "2023-06-11 17:08:57.750515"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/2c9fbd?url=https%3A%2F%2Fexample.com" for 127.0.0.1 at 2023-06-11 22:38:57 +0530
Processing by UrlsController#redirect as HTML
  Parameters: {"url"=>"https://example.com", "short_code"=>"2c9fbd"}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "2c9fbd"], ["LIMIT", 1]]
Redirected to https://example.com
Completed 302 Found in 2ms (ActiveRecord: 0.3ms | Allocations: 687)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------
UrlsControllerTest: test_should_return_a_list_of_URLs
-----------------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.com"], ["short_code", "74dcc6"], ["created_at", "2023-06-11 17:08:57.760200"], ["updated_at", "2023-06-11 17:08:57.760200"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mUrl Create (0.2ms)[0m  [1m[32mINSERT INTO "urls" ("original_url", "short_code", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["original_url", "https://example.org"], ["short_code", "c158bb"], ["created_at", "2023-06-11 17:08:57.762008"], ["updated_at", "2023-06-11 17:08:57.762008"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/urls" for 127.0.0.1 at 2023-06-11 22:38:57 +0530
Processing by UrlsController#index as HTML
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls"[0m
Completed 200 OK in 1ms (Views: 0.7ms | ActiveRecord: 0.2ms | Allocations: 567)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
UrlsControllerTest: test_should_handle_invalid_URL_creation
-----------------------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
Started POST "/urls" for 127.0.0.1 at 2023-06-11 22:38:57 +0530
Processing by UrlsController#create as HTML
  Parameters: {"url"=>{"original_url"=>"123"}}
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUrl Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "urls" WHERE "urls"."short_code" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
Completed 422 Unprocessable Entity in 4ms (Views: 0.1ms | ActiveRecord: 0.4ms | Allocations: 2274)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------
UrlsControllerTest: test_should_handle_URL_not_found
----------------------------------------------------
  [1m[36mUrl Delete All (0.2ms)[0m  [1m[31mDELETE FROM "urls"[0m
Started GET "/invalid_short_code" for 127.0.0.1 at 2023-06-11 22:38:57 +0530
Processing by UrlsController#redirect as HTML
  Parameters: {"short_code"=>"invalid_short_code"}
  [1m[36mUrl Load (0.2ms)[0m  [1m[34mSELECT "urls".* FROM "urls" WHERE "urls"."short_code" = $1 LIMIT $2[0m  [["short_code", "invalid_short_code"], ["LIMIT", 1]]
  Rendering text template
  Rendered text template (Duration: 0.0ms | Allocations: 8)
Completed 404 Not Found in 4ms (Views: 3.2ms | ActiveRecord: 0.2ms | Allocations: 2189)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
